<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lenny Budlinger">
<meta name="author" content="Thomas van der Wardt">
<meta name="author" content="Oliver Zingg">

<title>Analysing Flights</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="main_files/libs/clipboard/clipboard.min.js"></script>
<script src="main_files/libs/quarto-html/quarto.js"></script>
<script src="main_files/libs/quarto-html/popper.min.js"></script>
<script src="main_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="main_files/libs/quarto-html/anchor.min.js"></script>
<link href="main_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="main_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="main_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="main_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="main_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#packages" id="toc-packages" class="nav-link active" data-scroll-target="#packages"><span class="header-section-number">0.1</span> Packages</a></li>
  <li><a href="#load" id="toc-load" class="nav-link" data-scroll-target="#load"><span class="header-section-number">0.2</span> Load</a></li>
  <li><a href="#description-of-the-lga-data-set" id="toc-description-of-the-lga-data-set" class="nav-link" data-scroll-target="#description-of-the-lga-data-set"><span class="header-section-number">0.3</span> Description of the LGA Data set</a>
  <ul class="collapse">
  <li><a href="#total-flights-and-delays" id="toc-total-flights-and-delays" class="nav-link" data-scroll-target="#total-flights-and-delays"><span class="header-section-number">0.3.1</span> Total Flights and Delays</a></li>
  <li><a href="#departure-time" id="toc-departure-time" class="nav-link" data-scroll-target="#departure-time"><span class="header-section-number">0.3.2</span> Departure Time</a></li>
  <li><a href="#arrival-delay-by-day-and-season" id="toc-arrival-delay-by-day-and-season" class="nav-link" data-scroll-target="#arrival-delay-by-day-and-season"><span class="header-section-number">0.3.3</span> Arrival Delay by Day and Season</a></li>
  </ul></li>
  <li><a href="#linear-model" id="toc-linear-model" class="nav-link" data-scroll-target="#linear-model"><span class="header-section-number">1</span> Linear Model</a>
  <ul class="collapse">
  <li><a href="#post-hoc-tests" id="toc-post-hoc-tests" class="nav-link" data-scroll-target="#post-hoc-tests"><span class="header-section-number">1.1</span> Post-Hoc Tests</a></li>
  <li><a href="#interpretation-of-final-model" id="toc-interpretation-of-final-model" class="nav-link" data-scroll-target="#interpretation-of-final-model"><span class="header-section-number">1.2</span> Interpretation of final model</a>
  <ul class="collapse">
  <li><a href="#coefficients-of-model" id="toc-coefficients-of-model" class="nav-link" data-scroll-target="#coefficients-of-model"><span class="header-section-number">1.2.1</span> Coefficients of Model</a></li>
  <li><a href="#lets-explore-our-model-variables-a-bit-more" id="toc-lets-explore-our-model-variables-a-bit-more" class="nav-link" data-scroll-target="#lets-explore-our-model-variables-a-bit-more"><span class="header-section-number">1.2.2</span> Let’s explore our model variables a bit more</a></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics"><span class="header-section-number">1.2.3</span> Model diagnostics</a></li>
  <li><a href="#lets-look-at-density-plots" id="toc-lets-look-at-density-plots" class="nav-link" data-scroll-target="#lets-look-at-density-plots"><span class="header-section-number">1.2.4</span> Let’s look at density plots</a></li>
  <li><a href="#transformation" id="toc-transformation" class="nav-link" data-scroll-target="#transformation"><span class="header-section-number">1.2.5</span> Transformation</a></li>
  <li><a href="#z-normalization" id="toc-z-normalization" class="nav-link" data-scroll-target="#z-normalization"><span class="header-section-number">1.2.6</span> z-normalization</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#gam" id="toc-gam" class="nav-link" data-scroll-target="#gam"><span class="header-section-number">2</span> GAM</a></li>
  <li><a href="#glm-poisson" id="toc-glm-poisson" class="nav-link" data-scroll-target="#glm-poisson"><span class="header-section-number">3</span> GLM Poisson</a></li>
  <li><a href="#glm-binomial" id="toc-glm-binomial" class="nav-link" data-scroll-target="#glm-binomial"><span class="header-section-number">4</span> GLM Binomial</a>
  <ul class="collapse">
  <li><a href="#percentage-of-flights-with-more-than-180-minutes-delay" id="toc-percentage-of-flights-with-more-than-180-minutes-delay" class="nav-link" data-scroll-target="#percentage-of-flights-with-more-than-180-minutes-delay"><span class="header-section-number">4.1</span> Percentage of flights with more than 180 minutes delay</a>
  <ul class="collapse">
  <li><a href="#aggregated-data" id="toc-aggregated-data" class="nav-link" data-scroll-target="#aggregated-data"><span class="header-section-number">4.1.1</span> Aggregated Data</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#neural-network" id="toc-neural-network" class="nav-link" data-scroll-target="#neural-network"><span class="header-section-number">5</span> Neural Network</a>
  <ul class="collapse">
  <li><a href="#features" id="toc-features" class="nav-link" data-scroll-target="#features"><span class="header-section-number">5.1</span> Features</a></li>
  </ul></li>
  <li><a href="#support-vector-machine" id="toc-support-vector-machine" class="nav-link" data-scroll-target="#support-vector-machine"><span class="header-section-number">6</span> Support Vector Machine</a>
  <ul class="collapse">
  <li><a href="#eda-and-data-preprocessing" id="toc-eda-and-data-preprocessing" class="nav-link" data-scroll-target="#eda-and-data-preprocessing"><span class="header-section-number">6.1</span> EDA and Data Preprocessing</a>
  <ul class="collapse">
  <li><a href="#selecting-the-target-variable" id="toc-selecting-the-target-variable" class="nav-link" data-scroll-target="#selecting-the-target-variable"><span class="header-section-number">6.1.1</span> Selecting the Target Variable</a></li>
  <li><a href="#feature-selection-engineering" id="toc-feature-selection-engineering" class="nav-link" data-scroll-target="#feature-selection-engineering"><span class="header-section-number">6.1.2</span> Feature Selection &amp; Engineering</a></li>
  </ul></li>
  <li><a href="#svm-modeling" id="toc-svm-modeling" class="nav-link" data-scroll-target="#svm-modeling"><span class="header-section-number">6.2</span> SVM Modeling</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation"><span class="header-section-number">6.3</span> Interpretation</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">7</span> Conclusion</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analysing Flights</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Lenny Budlinger </p>
             <p>Thomas van der Wardt </p>
             <p>Oliver Zingg </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="packages" class="level2" data-number="0.1">
<h2 data-number="0.1" class="anchored" data-anchor-id="packages"><span class="header-section-number">0.1</span> Packages</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Scientific notation</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Load packages -----------------------------</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(tidyverse) <span class="co"># ggplot for plotting, dplyr for data manipulation</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(lubridate) <span class="co"># package for handling time variable</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(hms) <span class="co"># handling time</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">library</span>(gt) <span class="co"># Print tables</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">library</span>(forcats) <span class="co"># Reorder factor levels</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="fu">library</span>(multcomp) <span class="co"># Multiple comparison tests</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="fu">library</span>(patchwork) <span class="co">#plots side by side</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="fu">library</span>(kernlab) <span class="co"># SVM methodology</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="fu">library</span>(e1071) <span class="co"># SVM methodology</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="fu">library</span>(ISLR) <span class="co"># contains example data set "Khan"</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="fu">library</span>(RColorBrewer) </span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="fu">library</span>(randomForest) <span class="co">#For feature selection</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="fu">library</span>(keras)</span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="fu">library</span>(ROSE)</span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="fu">library</span>(DMwR2) </span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="fu">library</span>(smotefamily)</span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="fu">library</span>(tensorflow)</span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="fu">library</span>(car)</span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="fu">library</span>(keras)</span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="fu">library</span>(neuralnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load" class="level2" data-number="0.2">
<h2 data-number="0.2" class="anchored" data-anchor-id="load"><span class="header-section-number">0.2</span> Load</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Load data ---------------------------</span></span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># get working directory if csv not loading or use absolute path</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># getwd() </span></span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="fu">load</span>(<span class="st">"./../Data/LGA_preprocessed.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="description-of-the-lga-data-set" class="level2" data-number="0.3">
<h2 data-number="0.3" class="anchored" data-anchor-id="description-of-the-lga-data-set"><span class="header-section-number">0.3</span> Description of the LGA Data set</h2>
<section id="total-flights-and-delays" class="level3" data-number="0.3.1">
<h3 data-number="0.3.1" class="anchored" data-anchor-id="total-flights-and-delays"><span class="header-section-number">0.3.1</span> Total Flights and Delays</h3>
<p>For the following table we defined a flight as delayed if the arrival or departure delay is greater than 30 minutes.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Create table</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>planes <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">mutate</span>(<span class="at">index_late_arr =</span> <span class="fu">ifelse</span>(ARR_DELAY <span class="sc">&gt;</span> <span class="dv">30</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb3-4"><a href="#cb3-4"></a>         <span class="at">index_late_dep =</span> <span class="fu">ifelse</span>(DEP_DELAY <span class="sc">&gt;</span> <span class="dv">30</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>  <span class="fu">group_by</span>(OP_CARRIER) <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="at">Total_flights =</span> <span class="fu">n</span>(),</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="at">Total_delayed_arr =</span> <span class="fu">sum</span>(index_late_arr <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="at">percentage_delayed_arr =</span> Total_delayed_arr <span class="sc">/</span> Total_flights <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb3-10"><a href="#cb3-10"></a>    </span>
<span id="cb3-11"><a href="#cb3-11"></a>    <span class="at">Total_delayed_dep =</span> <span class="fu">sum</span>(index_late_dep <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="at">percentage_delayed_dep =</span> Total_delayed_dep <span class="sc">/</span> Total_flights <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb3-13"><a href="#cb3-13"></a>    </span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="at">median_dep_delay =</span> <span class="fu">median</span>(DEP_DELAY, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="at">median_arr_delay =</span> <span class="fu">median</span>(ARR_DELAY, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-16"><a href="#cb3-16"></a>    <span class="at">median_distance =</span> <span class="fu">median</span>(DISTANCE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-17"><a href="#cb3-17"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-20"><a href="#cb3-20"></a>    <span class="at">percentage_of_total =</span> Total_flights <span class="sc">/</span> <span class="fu">sum</span>(Total_flights) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb3-21"><a href="#cb3-21"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-22"><a href="#cb3-22"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.double), <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb3-23"><a href="#cb3-23"></a>  <span class="fu">relocate</span>(percentage_of_total, <span class="at">.after =</span> Total_flights)  <span class="sc">%&gt;%</span> </span>
<span id="cb3-24"><a href="#cb3-24"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Total_flights)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-25"><a href="#cb3-25"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb3-27"><a href="#cb3-27"></a>    <span class="at">table.font.size =</span> <span class="fu">px</span>(<span class="dv">8</span>),</span>
<span id="cb3-28"><a href="#cb3-28"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<div id="wdxzsnetnq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wdxzsnetnq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wdxzsnetnq thead, #wdxzsnetnq tbody, #wdxzsnetnq tfoot, #wdxzsnetnq tr, #wdxzsnetnq td, #wdxzsnetnq th {
  border-style: none;
}

#wdxzsnetnq p {
  margin: 0;
  padding: 0;
}

#wdxzsnetnq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 8px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wdxzsnetnq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wdxzsnetnq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wdxzsnetnq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wdxzsnetnq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wdxzsnetnq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wdxzsnetnq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wdxzsnetnq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wdxzsnetnq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wdxzsnetnq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wdxzsnetnq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wdxzsnetnq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wdxzsnetnq .gt_spanner_row {
  border-bottom-style: hidden;
}

#wdxzsnetnq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wdxzsnetnq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wdxzsnetnq .gt_from_md > :first-child {
  margin-top: 0;
}

#wdxzsnetnq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wdxzsnetnq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wdxzsnetnq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wdxzsnetnq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wdxzsnetnq .gt_row_group_first td {
  border-top-width: 2px;
}

#wdxzsnetnq .gt_row_group_first th {
  border-top-width: 2px;
}

#wdxzsnetnq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wdxzsnetnq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wdxzsnetnq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wdxzsnetnq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wdxzsnetnq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wdxzsnetnq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wdxzsnetnq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wdxzsnetnq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wdxzsnetnq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wdxzsnetnq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wdxzsnetnq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wdxzsnetnq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wdxzsnetnq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wdxzsnetnq .gt_left {
  text-align: left;
}

#wdxzsnetnq .gt_center {
  text-align: center;
}

#wdxzsnetnq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wdxzsnetnq .gt_font_normal {
  font-weight: normal;
}

#wdxzsnetnq .gt_font_bold {
  font-weight: bold;
}

#wdxzsnetnq .gt_font_italic {
  font-style: italic;
}

#wdxzsnetnq .gt_super {
  font-size: 65%;
}

#wdxzsnetnq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wdxzsnetnq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wdxzsnetnq .gt_indent_1 {
  text-indent: 5px;
}

#wdxzsnetnq .gt_indent_2 {
  text-indent: 10px;
}

#wdxzsnetnq .gt_indent_3 {
  text-indent: 15px;
}

#wdxzsnetnq .gt_indent_4 {
  text-indent: 20px;
}

#wdxzsnetnq .gt_indent_5 {
  text-indent: 25px;
}

#wdxzsnetnq .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wdxzsnetnq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="OP_CARRIER" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">OP_CARRIER</th>
<th id="Total_flights" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Total_flights</th>
<th id="percentage_of_total" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percentage_of_total</th>
<th id="Total_delayed_arr" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Total_delayed_arr</th>
<th id="percentage_delayed_arr" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percentage_delayed_arr</th>
<th id="Total_delayed_dep" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Total_delayed_dep</th>
<th id="percentage_delayed_dep" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">percentage_delayed_dep</th>
<th id="median_dep_delay" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">median_dep_delay</th>
<th id="median_arr_delay" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">median_arr_delay</th>
<th id="median_distance" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">median_distance</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="OP_CARRIER">AA</td>
<td class="gt_row gt_right" headers="Total_flights">16968</td>
<td class="gt_row gt_right" headers="percentage_of_total">16.91</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">2086</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">12.29</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">1769</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">10.43</td>
<td class="gt_row gt_right" headers="median_dep_delay">-3</td>
<td class="gt_row gt_right" headers="median_arr_delay">-8</td>
<td class="gt_row gt_right" headers="median_distance">1097</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="OP_CARRIER">DL</td>
<td class="gt_row gt_right" headers="Total_flights">14455</td>
<td class="gt_row gt_right" headers="percentage_of_total">14.41</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">1618</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">11.19</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">1359</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">9.40</td>
<td class="gt_row gt_right" headers="median_dep_delay">-2</td>
<td class="gt_row gt_right" headers="median_arr_delay">-7</td>
<td class="gt_row gt_right" headers="median_distance">761</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="OP_CARRIER">US</td>
<td class="gt_row gt_right" headers="Total_flights">12774</td>
<td class="gt_row gt_right" headers="percentage_of_total">12.73</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">889</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">6.96</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">580</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">4.54</td>
<td class="gt_row gt_right" headers="median_dep_delay">-6</td>
<td class="gt_row gt_right" headers="median_arr_delay">-10</td>
<td class="gt_row gt_right" headers="median_distance">214</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="OP_CARRIER">MQ</td>
<td class="gt_row gt_right" headers="Total_flights">11298</td>
<td class="gt_row gt_right" headers="percentage_of_total">11.26</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">1368</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">12.11</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">1243</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">11.00</td>
<td class="gt_row gt_right" headers="median_dep_delay">-4</td>
<td class="gt_row gt_right" headers="median_arr_delay">-7</td>
<td class="gt_row gt_right" headers="median_distance">431</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="OP_CARRIER">OH</td>
<td class="gt_row gt_right" headers="Total_flights">11162</td>
<td class="gt_row gt_right" headers="percentage_of_total">11.12</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">2018</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">18.08</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">1796</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">16.09</td>
<td class="gt_row gt_right" headers="median_dep_delay">0</td>
<td class="gt_row gt_right" headers="median_arr_delay">0</td>
<td class="gt_row gt_right" headers="median_distance">641</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="OP_CARRIER">NW</td>
<td class="gt_row gt_right" headers="Total_flights">8754</td>
<td class="gt_row gt_right" headers="percentage_of_total">8.72</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">1219</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">13.93</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">1025</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">11.71</td>
<td class="gt_row gt_right" headers="median_dep_delay">-2</td>
<td class="gt_row gt_right" headers="median_arr_delay">-4</td>
<td class="gt_row gt_right" headers="median_distance">1011</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="OP_CARRIER">UA</td>
<td class="gt_row gt_right" headers="Total_flights">6578</td>
<td class="gt_row gt_right" headers="percentage_of_total">6.56</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">840</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">12.77</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">858</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">13.04</td>
<td class="gt_row gt_right" headers="median_dep_delay">-3</td>
<td class="gt_row gt_right" headers="median_arr_delay">-11</td>
<td class="gt_row gt_right" headers="median_distance">733</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="OP_CARRIER">FL</td>
<td class="gt_row gt_right" headers="Total_flights">5954</td>
<td class="gt_row gt_right" headers="percentage_of_total">5.93</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">1001</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">16.81</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">923</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">15.50</td>
<td class="gt_row gt_right" headers="median_dep_delay">-4</td>
<td class="gt_row gt_right" headers="median_arr_delay">-5</td>
<td class="gt_row gt_right" headers="median_distance">761</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="OP_CARRIER">CO</td>
<td class="gt_row gt_right" headers="Total_flights">3666</td>
<td class="gt_row gt_right" headers="percentage_of_total">3.65</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">510</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">13.91</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">436</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">11.89</td>
<td class="gt_row gt_right" headers="median_dep_delay">-2</td>
<td class="gt_row gt_right" headers="median_arr_delay">-5</td>
<td class="gt_row gt_right" headers="median_distance">1416</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="OP_CARRIER">B6</td>
<td class="gt_row gt_right" headers="Total_flights">2899</td>
<td class="gt_row gt_right" headers="percentage_of_total">2.89</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">530</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">18.28</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">474</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">16.35</td>
<td class="gt_row gt_right" headers="median_dep_delay">-2</td>
<td class="gt_row gt_right" headers="median_arr_delay">-3</td>
<td class="gt_row gt_right" headers="median_distance">1076</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="OP_CARRIER">9E</td>
<td class="gt_row gt_right" headers="Total_flights">1547</td>
<td class="gt_row gt_right" headers="percentage_of_total">1.54</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">173</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">11.18</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">160</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">10.34</td>
<td class="gt_row gt_right" headers="median_dep_delay">-3</td>
<td class="gt_row gt_right" headers="median_arr_delay">-9</td>
<td class="gt_row gt_right" headers="median_distance">659</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="OP_CARRIER">WN</td>
<td class="gt_row gt_right" headers="Total_flights">1422</td>
<td class="gt_row gt_right" headers="percentage_of_total">1.42</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">206</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">14.49</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">244</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">17.16</td>
<td class="gt_row gt_right" headers="median_dep_delay">1</td>
<td class="gt_row gt_right" headers="median_arr_delay">-11</td>
<td class="gt_row gt_right" headers="median_distance">725</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="OP_CARRIER">YV</td>
<td class="gt_row gt_right" headers="Total_flights">1041</td>
<td class="gt_row gt_right" headers="percentage_of_total">1.04</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">149</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">14.31</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">155</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">14.89</td>
<td class="gt_row gt_right" headers="median_dep_delay">-3</td>
<td class="gt_row gt_right" headers="median_arr_delay">-9</td>
<td class="gt_row gt_right" headers="median_distance">229</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="OP_CARRIER">XE</td>
<td class="gt_row gt_right" headers="Total_flights">890</td>
<td class="gt_row gt_right" headers="percentage_of_total">0.89</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">135</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">15.17</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">131</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">14.72</td>
<td class="gt_row gt_right" headers="median_dep_delay">-6</td>
<td class="gt_row gt_right" headers="median_arr_delay">-11</td>
<td class="gt_row gt_right" headers="median_distance">418</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="OP_CARRIER">F9</td>
<td class="gt_row gt_right" headers="Total_flights">727</td>
<td class="gt_row gt_right" headers="percentage_of_total">0.72</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">110</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">15.13</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">70</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">9.63</td>
<td class="gt_row gt_right" headers="median_dep_delay">-3</td>
<td class="gt_row gt_right" headers="median_arr_delay">0</td>
<td class="gt_row gt_right" headers="median_distance">1619</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="OP_CARRIER">EV</td>
<td class="gt_row gt_right" headers="Total_flights">172</td>
<td class="gt_row gt_right" headers="percentage_of_total">0.17</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">21</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">12.21</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">24</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">13.95</td>
<td class="gt_row gt_right" headers="median_dep_delay">-2</td>
<td class="gt_row gt_right" headers="median_arr_delay">-9</td>
<td class="gt_row gt_right" headers="median_distance">617</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="OP_CARRIER">OO</td>
<td class="gt_row gt_right" headers="Total_flights">27</td>
<td class="gt_row gt_right" headers="percentage_of_total">0.03</td>
<td class="gt_row gt_right" headers="Total_delayed_arr">7</td>
<td class="gt_row gt_right" headers="percentage_delayed_arr">25.93</td>
<td class="gt_row gt_right" headers="Total_delayed_dep">4</td>
<td class="gt_row gt_right" headers="percentage_delayed_dep">14.81</td>
<td class="gt_row gt_right" headers="median_dep_delay">-1</td>
<td class="gt_row gt_right" headers="median_arr_delay">4</td>
<td class="gt_row gt_right" headers="median_distance">478</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>
</section>
<section id="departure-time" class="level3" data-number="0.3.2">
<h3 data-number="0.3.2" class="anchored" data-anchor-id="departure-time"><span class="header-section-number">0.3.2</span> Departure Time</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>planes <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CRS_DEP_TIME, <span class="at">y =</span> DEP_TIME)) <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plot shows the planned departure time on the x axis and the actual departure time an the y axis. Points on the diagonal departed on time. On the bottom right of the plot we see a few cases of flights that have a delay and depart on the next day early morning. This should be considered when using <code>DEP_TIME</code> in a statistical model. Since flights before 5 am are systematic different from flights after 5 am since these flights were planned to depart the day before.</p>
</section>
<section id="arrival-delay-by-day-and-season" class="level3" data-number="0.3.3">
<h3 data-number="0.3.3" class="anchored" data-anchor-id="arrival-delay-by-day-and-season"><span class="header-section-number">0.3.3</span> Arrival Delay by Day and Season</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>p1 <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">mutate</span>(<span class="at">Weekday =</span> <span class="fu">fct_relevel</span>(Weekday, <span class="st">"Monday"</span>, <span class="st">"Tuesday"</span>, <span class="st">"Wednesday"</span>, <span class="st">"Thursday"</span>, <span class="st">"Friday"</span>, <span class="st">"Saturday"</span>, <span class="st">"Sunday"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> ARR_DELAY)) <span class="sc">+</span> </span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.colour =</span> <span class="st">"red"</span>,<span class="at">outlier.shape =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept  =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>,<span class="at">linetype=</span><span class="st">'dotted'</span>) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Weekday)<span class="sc">+</span> </span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a>p2 <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span> </span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">mutate</span>(<span class="at">Weekday =</span> <span class="fu">fct_relevel</span>(Weekday, <span class="st">"Monday"</span>, <span class="st">"Tuesday"</span>, <span class="st">"Wednesday"</span>, <span class="st">"Thursday"</span>, <span class="st">"Friday"</span>, <span class="st">"Saturday"</span>, <span class="st">"Sunday"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-12"><a href="#cb5-12"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Season, ARR_DELAY)) <span class="sc">+</span> </span>
<span id="cb5-13"><a href="#cb5-13"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span> </span>
<span id="cb5-14"><a href="#cb5-14"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept  =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="st">'dotted'</span>,<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Weekday) <span class="sc">+</span> </span>
<span id="cb5-16"><a href="#cb5-16"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb5-18"><a href="#cb5-18"></a>  </span>
<span id="cb5-19"><a href="#cb5-19"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Arrival Delay are similar across the weekdays and season. On weekends the median of arrival delay seems to be a bit lower. The violin plot give us a feeling of how skewed arrival delay is and how different the median and average are. Other variables in this data set are similarly skewed, therefore modeling the average may not represent the biggest part of the data. We will later see if we can handle this skewness.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>planes <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(DEP_DELAY,ARR_DELAY,CRS_DEP_TIME,WHEELS_OFF,WHEELS_ON, DISTANCE,ACTUAL_ELAPSED_TIME, TAXI_OUT, TAXI_IN ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"complete.obs"</span>) <span class="sc">%&gt;%</span> <span class="fu">kable</span>(<span class="at">caption =</span> <span class="st">"Correlation matrix of different variables"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Correlation matrix of different variables</caption>
<colgroup>
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">DEP_DELAY</th>
<th style="text-align: right;">ARR_DELAY</th>
<th style="text-align: right;">CRS_DEP_TIME</th>
<th style="text-align: right;">WHEELS_OFF</th>
<th style="text-align: right;">WHEELS_ON</th>
<th style="text-align: right;">DISTANCE</th>
<th style="text-align: right;">ACTUAL_ELAPSED_TIME</th>
<th style="text-align: right;">TAXI_OUT</th>
<th style="text-align: right;">TAXI_IN</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">DEP_DELAY</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.8879422</td>
<td style="text-align: right;">0.1780300</td>
<td style="text-align: right;">0.2329716</td>
<td style="text-align: right;">0.0879676</td>
<td style="text-align: right;">0.0530508</td>
<td style="text-align: right;">0.0608624</td>
<td style="text-align: right;">0.0540390</td>
<td style="text-align: right;">-0.0049062</td>
</tr>
<tr class="even">
<td style="text-align: left;">ARR_DELAY</td>
<td style="text-align: right;">0.8879422</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.1449869</td>
<td style="text-align: right;">0.2149834</td>
<td style="text-align: right;">0.0900263</td>
<td style="text-align: right;">0.0343948</td>
<td style="text-align: right;">0.1903733</td>
<td style="text-align: right;">0.4001428</td>
<td style="text-align: right;">0.0866103</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CRS_DEP_TIME</td>
<td style="text-align: right;">0.1780300</td>
<td style="text-align: right;">0.1449869</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.9710676</td>
<td style="text-align: right;">0.8135008</td>
<td style="text-align: right;">-0.0707239</td>
<td style="text-align: right;">-0.0456351</td>
<td style="text-align: right;">0.1120957</td>
<td style="text-align: right;">-0.0622022</td>
</tr>
<tr class="even">
<td style="text-align: left;">WHEELS_OFF</td>
<td style="text-align: right;">0.2329716</td>
<td style="text-align: right;">0.2149834</td>
<td style="text-align: right;">0.9710676</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.8279598</td>
<td style="text-align: right;">-0.0603341</td>
<td style="text-align: right;">-0.0160242</td>
<td style="text-align: right;">0.1730932</td>
<td style="text-align: right;">-0.0561931</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WHEELS_ON</td>
<td style="text-align: right;">0.0879676</td>
<td style="text-align: right;">0.0900263</td>
<td style="text-align: right;">0.8135008</td>
<td style="text-align: right;">0.8279598</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.0066490</td>
<td style="text-align: right;">0.0596126</td>
<td style="text-align: right;">0.1755272</td>
<td style="text-align: right;">-0.0181294</td>
</tr>
<tr class="even">
<td style="text-align: left;">DISTANCE</td>
<td style="text-align: right;">0.0530508</td>
<td style="text-align: right;">0.0343948</td>
<td style="text-align: right;">-0.0707239</td>
<td style="text-align: right;">-0.0603341</td>
<td style="text-align: right;">0.0066490</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.9298512</td>
<td style="text-align: right;">-0.0095594</td>
<td style="text-align: right;">0.1186520</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACTUAL_ELAPSED_TIME</td>
<td style="text-align: right;">0.0608624</td>
<td style="text-align: right;">0.1903733</td>
<td style="text-align: right;">-0.0456351</td>
<td style="text-align: right;">-0.0160242</td>
<td style="text-align: right;">0.0596126</td>
<td style="text-align: right;">0.9298512</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">0.2885034</td>
<td style="text-align: right;">0.2081655</td>
</tr>
<tr class="even">
<td style="text-align: left;">TAXI_OUT</td>
<td style="text-align: right;">0.0540390</td>
<td style="text-align: right;">0.4001428</td>
<td style="text-align: right;">0.1120957</td>
<td style="text-align: right;">0.1730932</td>
<td style="text-align: right;">0.1755272</td>
<td style="text-align: right;">-0.0095594</td>
<td style="text-align: right;">0.2885034</td>
<td style="text-align: right;">1.0000000</td>
<td style="text-align: right;">-0.0091804</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TAXI_IN</td>
<td style="text-align: right;">-0.0049062</td>
<td style="text-align: right;">0.0866103</td>
<td style="text-align: right;">-0.0622022</td>
<td style="text-align: right;">-0.0561931</td>
<td style="text-align: right;">-0.0181294</td>
<td style="text-align: right;">0.1186520</td>
<td style="text-align: right;">0.2081655</td>
<td style="text-align: right;">-0.0091804</td>
<td style="text-align: right;">1.0000000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This correlation plot helps us understand the relationship and colinearity among the potential variables used in our models. Some variables are time based (for example: <code>CRS_DEP_TIM</code>, <code>WHEELS_OFF</code>) with small differences, making them nearly perfect correlated. Such variables shouldn’t be included in the model together as they make the coefficients unstable. Other than that interesting potential predictors can be assessed from this correlation matrix.</p>
</section>
</section>
<section id="linear-model" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Linear Model</h1>
<p><strong>Aim: Investigating the factors contributing to delays in arrival.</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>p1 <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> DEP_DELAY, <span class="at">y =</span> ARR_DELAY)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"Influence of Depature Delay on Arrival Delay"</span>,</span>
<span id="cb7-7"><a href="#cb7-7"></a>       <span class="at">x =</span> <span class="st">"Departure Delay"</span>,</span>
<span id="cb7-8"><a href="#cb7-8"></a>       <span class="at">y =</span> <span class="st">"Arrival Delay"</span>) </span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a>p2 <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span> </span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TAXI_OUT, <span class="at">y =</span> ARR_DELAY)) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Influence of Taxi Out on Arrival Delay"</span>,</span>
<span id="cb7-16"><a href="#cb7-16"></a>       <span class="at">x =</span> <span class="st">"Taxi Out"</span>,</span>
<span id="cb7-17"><a href="#cb7-17"></a>       <span class="at">y =</span> <span class="st">"Arrival Delay"</span>) </span>
<span id="cb7-18"><a href="#cb7-18"></a></span>
<span id="cb7-19"><a href="#cb7-19"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From the plots above we see that both <code>DEP_DELAY</code> and <code>TAXI_OUT</code> are positively correlated with <code>ARR_DELAY</code>. It’s obvious that a delay in departure leads to a delay in arrival. Furthermore, the skeweness is again visiable in the plot. ## Modelling Selection</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: ARR_DELAY ~ DEP_DELAY
Model 2: ARR_DELAY ~ DEP_DELAY + TAXI_OUT
  Res.Df      RSS Df Sum of Sq      F                Pr(&gt;F)    
1  96067 34554235                                              
2  96066 14239138  1  20315097 137058 &lt; 0.00000000000000022 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Single term deletions

Model:
ARR_DELAY ~ DEP_DELAY + TAXI_OUT + OP_CARRIER
           Df Sum of Sq       RSS    AIC   F value                Pr(&gt;F)    
&lt;none&gt;                   13177731 472814                                    
DEP_DELAY   1 122296267 135473998 696677 891394.49 &lt; 0.00000000000000022 ***
TAXI_OUT    1  20788072  33965803 563773 151520.35 &lt; 0.00000000000000022 ***
OP_CARRIER 16   1061408  14239138 480224    483.52 &lt; 0.00000000000000022 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We use <code>drop1</code> function, since <code>OP_CARRIER</code> has more than two levels. The addition of the <code>OP_CARRIER</code> variable significantly improves the model fit.</p>
<p>It could be more interesting to group the different <code>OP_CARRIER</code> into three categories of Cheap, Mid-tier and expensive airlines. For this we use chatGPT. Having three categories instead of 14 will help us to reduce the complexity of the model and make it easier to interpret and compare different levels of airlines. Especially, since some airlines how low flight counts. Of course these categories may not be complete true for each case. As ChatGPT mentions some airlines blur the categories as they could be considered cheap and or mid-tier and so on.</p>
<div class="cell">
<details class="code-fold">
<summary>Show ChatGPT classification</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>planes <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">OP_CARRIER_Tier =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(OP_CARRIER,</span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="co"># Expensive</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="st">"AA"</span> <span class="ot">=</span> <span class="st">"Expensive"</span>,</span>
<span id="cb10-5"><a href="#cb10-5"></a>    <span class="st">"DL"</span> <span class="ot">=</span> <span class="st">"Expensive"</span>,</span>
<span id="cb10-6"><a href="#cb10-6"></a>    <span class="st">"UA"</span> <span class="ot">=</span> <span class="st">"Expensive"</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>    <span class="st">"CO"</span> <span class="ot">=</span> <span class="st">"Expensive"</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="co"># Cheap</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>    <span class="st">"B6"</span> <span class="ot">=</span> <span class="st">"Cheap"</span>,</span>
<span id="cb10-11"><a href="#cb10-11"></a>    <span class="st">"F9"</span> <span class="ot">=</span> <span class="st">"Cheap"</span>,</span>
<span id="cb10-12"><a href="#cb10-12"></a>    <span class="st">"FL"</span> <span class="ot">=</span> <span class="st">"Cheap"</span>,</span>
<span id="cb10-13"><a href="#cb10-13"></a>    <span class="st">"WN"</span> <span class="ot">=</span> <span class="st">"Cheap"</span>,</span>
<span id="cb10-14"><a href="#cb10-14"></a></span>
<span id="cb10-15"><a href="#cb10-15"></a>    <span class="co"># Mid-tier</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>    <span class="st">"9E"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb10-17"><a href="#cb10-17"></a>    <span class="st">"EV"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb10-18"><a href="#cb10-18"></a>    <span class="st">"MQ"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb10-19"><a href="#cb10-19"></a>    <span class="st">"OH"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb10-20"><a href="#cb10-20"></a>    <span class="st">"OO"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb10-21"><a href="#cb10-21"></a>    <span class="st">"XE"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb10-22"><a href="#cb10-22"></a>    <span class="st">"YV"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb10-23"><a href="#cb10-23"></a>    <span class="st">"NW"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb10-24"><a href="#cb10-24"></a>    <span class="st">"US"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb10-25"><a href="#cb10-25"></a></span>
<span id="cb10-26"><a href="#cb10-26"></a>    <span class="at">.default =</span> <span class="cn">NA_character_</span></span>
<span id="cb10-27"><a href="#cb10-27"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb10-28"><a href="#cb10-28"></a>  <span class="fu">mutate</span>(<span class="at">OP_CARRIER_Tier =</span> <span class="fu">factor</span>(OP_CARRIER_Tier, </span>
<span id="cb10-29"><a href="#cb10-29"></a>                                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Cheap"</span>, <span class="st">"Mid-tier"</span>, <span class="st">"Expensive"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>With including the <code>OP_CARRIER_Tier</code> variable we lose the individual information of each airline. Still, this is done because adding <code>OP_CARRIER_Tier</code> and <code>OP_CARRIER</code> would properly lead to rank-deficiency.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Single term deletions

Model:
ARR_DELAY ~ DEP_DELAY + TAXI_OUT + OP_CARRIER_Tier
                Df Sum of Sq       RSS    AIC   F value                Pr(&gt;F)
&lt;none&gt;                        14133173 479511                                
DEP_DELAY        1 122177108 136310281 697241 830444.90 &lt; 0.00000000000000022
TAXI_OUT         1  20280397  34413571 565003 137847.04 &lt; 0.00000000000000022
OP_CARRIER_Tier  2    105965  14239138 480224    360.13 &lt; 0.00000000000000022
                   
&lt;none&gt;             
DEP_DELAY       ***
TAXI_OUT        ***
OP_CARRIER_Tier ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>After transformation <code>OP_CARRIER_Tier</code> significantly improves the model.</p>
<section id="post-hoc-tests" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="post-hoc-tests"><span class="header-section-number">1.1</span> Post-Hoc Tests</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>ph.test.THSD <span class="ot">&lt;-</span> <span class="fu">glht</span>(lm.arrival<span class="fl">.4</span>,</span>
<span id="cb12-2"><a href="#cb12-2"></a>    <span class="at">linfct =</span> <span class="fu">mcp</span>(<span class="at">OP_CARRIER_Tier =</span> <span class="st">"Tukey"</span>))</span>
<span id="cb12-3"><a href="#cb12-3"></a></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="fu">summary</span>(ph.test.THSD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="color: blue"><code>
     Simultaneous Tests for General Linear Hypotheses

Multiple Comparisons of Means: Tukey Contrasts


Fit: lm(formula = ARR_DELAY ~ DEP_DELAY + TAXI_OUT + OP_CARRIER_Tier, 
    data = planes)

Linear Hypotheses:
                          Estimate Std. Error t value      Pr(&gt;|t|)    
Mid-tier - Cheap == 0     -2.89168    0.13077 -22.112 &lt;0.0000000001 ***
Expensive - Cheap == 0    -3.54434    0.13219 -26.813 &lt;0.0000000001 ***
Expensive - Mid-tier == 0 -0.65267    0.08342  -7.824 &lt;0.0000000001 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
(Adjusted p values reported -- single-step method)</code></pre>
</div>
</div>
<p>We find strong evidence that all three pairwise differences are not equal to zero. Lets plot the differences:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">5.1</span>,<span class="fl">7.5</span>,<span class="fl">4.1</span>,<span class="fl">2.1</span>))</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="fu">plot</span>(ph.test.THSD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plots shows us that the the difference between airline tiers is not zero in any case. Furthermore, the differences follow the possible intuition that cheaper flights are more likely to be delayed than mid-tier and expensive flights.</p>
</section>
<section id="interpretation-of-final-model" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="interpretation-of-final-model"><span class="header-section-number">1.2</span> Interpretation of final model</h2>
<section id="coefficients-of-model" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="coefficients-of-model"><span class="header-section-number">1.2.1</span> Coefficients of Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(lm.arrival<span class="fl">.4</span>)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="color: blue"><code>                            Estimate Std. Error    t value Pr(&gt;|t|)
(Intercept)              -26.8580317  0.1316097 -204.07342        0
DEP_DELAY                  0.9760097  0.0010710  911.28750        0
TAXI_OUT                   0.9345674  0.0025172  371.27758        0
OP_CARRIER_TierMid-tier   -2.8916776  0.1307739  -22.11204        0
OP_CARRIER_TierExpensive  -3.5443432  0.1321894  -26.81262        0</code></pre>
</div>
</div>
<ul>
<li><code>DEP_DEALY</code>: given all predictors in the model are kept constant, a 1 minute increase in <code>DEP_DELAY</code> leads to an increase in <code>ARR_DELAY</code> of 0.976 minutes on <em>average</em>.</li>
<li><code>TAXI_OUT</code>: given all predictors in the model are kept constant, a 1 minute increase in <code>TAXI_OUT</code> leads to an increase in <code>ARR_DELAY</code> of 0.935 minutes on <em>average</em>.</li>
<li><code>Intercept</code>: With <code>DEP_DELAY</code> and <code>TAXI_OUT</code> being 0, the average <code>ARR_DELAY</code> of <code>Cheap Airlines</code> is -26.858. Meaning that <strong>on average</strong> these flights arrival 27 min early. While a departure delay of zero is realistic and in range of our data, the taxi out time of zero is not realistic. With min of taxi out being 1. We could center <code>TAXI_OUT</code> so that zero represents the average taxi out time.</li>
<li><code>TierMid-tier</code>: <strong>on average</strong> Mid-tier airlines arrive 2.892 minutes earlier compared to cheap airlines.<br>
</li>
<li><code>TierExpensive</code>: <strong>on average</strong> Expensive airlines arrive 3.544 minutes earlier compared to cheap airlines.</li>
</ul>
</section>
<section id="lets-explore-our-model-variables-a-bit-more" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="lets-explore-our-model-variables-a-bit-more"><span class="header-section-number">1.2.2</span> Let’s explore our model variables a bit more</h3>
</section>
<section id="model-diagnostics" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="model-diagnostics"><span class="header-section-number">1.2.3</span> Model diagnostics</h3>
</section>
<section id="lets-look-at-density-plots" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="lets-look-at-density-plots"><span class="header-section-number">1.2.4</span> Let’s look at density plots</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">plot</span>(lm.arrival<span class="fl">.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>The <code>Q-Q plot</code> shows that the residuals are not normally distributed for higher values of <code>ARR_DELAY</code>.</li>
<li>The <code>Fitted vs. Residuals plot</code> shows a clear case of heteroscedasticity where the variance is not constant across predicted values.</li>
</ul>
</section>
<section id="transformation" class="level3" data-number="1.2.5">
<h3 data-number="1.2.5" class="anchored" data-anchor-id="transformation"><span class="header-section-number">1.2.5</span> Transformation</h3>
<p>Since we have a lot of negative and zero values, we can’t use log transformation. Therefore we try a cubic root transformation.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>planes <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(ARR_DELAY, TAXI_OUT, DEP_DELAY),</span>
<span id="cb18-3"><a href="#cb18-3"></a>               <span class="at">names_to =</span> <span class="st">"Metric"</span>,</span>
<span id="cb18-4"><a href="#cb18-4"></a>               <span class="at">values_to =</span> <span class="st">"Value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Value, <span class="at">fill =</span> Metric, <span class="at">color =</span> Metric)) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> OP_CARRIER_Tier) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">200</span>) <span class="sc">+</span> </span>
<span id="cb18-9"><a href="#cb18-9"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-10"><a href="#cb18-10"></a>    <span class="at">title =</span> <span class="st">"Before Transformation"</span>,</span>
<span id="cb18-11"><a href="#cb18-11"></a>    <span class="at">x =</span> <span class="st">"Value"</span>,</span>
<span id="cb18-12"><a href="#cb18-12"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>  ) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>  <span class="fu">theme_minimal</span>() <span class="ot">-&gt;</span> p1</span>
<span id="cb18-16"><a href="#cb18-16"></a></span>
<span id="cb18-17"><a href="#cb18-17"></a></span>
<span id="cb18-18"><a href="#cb18-18"></a>cbrt_transform <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb18-19"><a href="#cb18-19"></a>  <span class="fu">sign</span>(x) <span class="sc">*</span> <span class="fu">abs</span>(x)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb18-20"><a href="#cb18-20"></a>}</span>
<span id="cb18-21"><a href="#cb18-21"></a></span>
<span id="cb18-22"><a href="#cb18-22"></a>planes <span class="sc">%&gt;%</span></span>
<span id="cb18-23"><a href="#cb18-23"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-24"><a href="#cb18-24"></a>    <span class="at">cbrt_arr_delay =</span> <span class="fu">cbrt_transform</span>(ARR_DELAY),</span>
<span id="cb18-25"><a href="#cb18-25"></a>    <span class="at">cbrt_dep_delay =</span> <span class="fu">cbrt_transform</span>(DEP_DELAY),</span>
<span id="cb18-26"><a href="#cb18-26"></a>    <span class="at">cbrt_taxi_out  =</span> <span class="fu">cbrt_transform</span>(TAXI_OUT)</span>
<span id="cb18-27"><a href="#cb18-27"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb18-28"><a href="#cb18-28"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(cbrt_arr_delay, cbrt_taxi_out, cbrt_dep_delay),</span>
<span id="cb18-29"><a href="#cb18-29"></a>               <span class="at">names_to =</span> <span class="st">"Metric"</span>,</span>
<span id="cb18-30"><a href="#cb18-30"></a>               <span class="at">values_to =</span> <span class="st">"Value"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-31"><a href="#cb18-31"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Value, <span class="at">fill =</span> Metric, <span class="at">color =</span> Metric)) <span class="sc">+</span></span>
<span id="cb18-32"><a href="#cb18-32"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb18-33"><a href="#cb18-33"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> OP_CARRIER_Tier) <span class="sc">+</span></span>
<span id="cb18-34"><a href="#cb18-34"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-35"><a href="#cb18-35"></a>    <span class="at">title =</span> <span class="st">"After cubic root Transformation"</span>,</span>
<span id="cb18-36"><a href="#cb18-36"></a>    <span class="at">x =</span> <span class="st">"Value"</span>,</span>
<span id="cb18-37"><a href="#cb18-37"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb18-38"><a href="#cb18-38"></a>  ) <span class="sc">+</span></span>
<span id="cb18-39"><a href="#cb18-39"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)<span class="sc">+</span></span>
<span id="cb18-40"><a href="#cb18-40"></a>  <span class="fu">theme_minimal</span>() <span class="ot">-&gt;</span> p2 </span>
<span id="cb18-41"><a href="#cb18-41"></a></span>
<span id="cb18-42"><a href="#cb18-42"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The cubic root transformation produces a bimodal distribution for the <code>ARR_DELAY</code> and <code>DEP_DELAY</code> variables. Although this reveals an interesting pattern in the data, that most planes are on time (or more specific early) but the distribution shows slight delays to be somewhat common as well. Given the bimodality a normal regression modelling the average may not be better than using untransformed data. Interpretation of the model coefficents would become quit difficult after this transformation.</p>
</section>
<section id="z-normalization" class="level3" data-number="1.2.6">
<h3 data-number="1.2.6" class="anchored" data-anchor-id="z-normalization"><span class="header-section-number">1.2.6</span> z-normalization</h3>
<p>To help with interpretation and entangle the relative effects of <code>TAXI_OUT</code> and <code>DEP_DELAY</code> on <code>ARR_DELAY</code> we can z-normalize the variables. The model fit will not change (as shown later). But it will help with interpretation of the intercept since a z-value of zero represents the average of the variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>planes <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-3"><a href="#cb19-3"></a>    <span class="at">z_dep_delay =</span> <span class="fu">scale</span>(DEP_DELAY),</span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="at">z_taxi_out  =</span> <span class="fu">scale</span>(TAXI_OUT)</span>
<span id="cb19-5"><a href="#cb19-5"></a>  )</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a>lm.arrival<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">lm</span>(ARR_DELAY <span class="sc">~</span> z_dep_delay <span class="sc">+</span> z_taxi_out <span class="sc">+</span> OP_CARRIER_Tier, <span class="at">data =</span> planes)</span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co">#plot(lm.arrival.5)</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="fu">print</span>(<span class="fu">summary</span>(lm.arrival<span class="fl">.5</span>)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="color: blue"><code>                          Estimate Std. Error   t value Pr(&gt;|t|)
(Intercept)               6.304374  0.1174445  53.67961        0
z_dep_delay              35.854511  0.0393449 911.28750        0
z_taxi_out               14.655536  0.0394733 371.27758        0
OP_CARRIER_TierMid-tier  -2.891678  0.1307739 -22.11204        0
OP_CARRIER_TierExpensive -3.544343  0.1321894 -26.81262        0</code></pre>
</div>
</div>
<ul>
<li><code>Intercept</code>: Cheap airlines with average depature delay and average taxi out arrive <strong>on average</strong> 6.30 minutes late.</li>
<li><code>TierMid-tier</code>: Mid-tier airlines with average depature delay and average taxi out arrive <strong>on average</strong> 3.413 minutes late.</li>
<li><code>TierExpensive</code>: Expensive airlines with average depature delay and average taxi out arrive <strong>on average</strong> 2.76 minutes late.</li>
<li>This again shows that using the average for modelling may give us a biased picture.</li>
<li>We see that <code>z_dep_delay</code> has a higher relative effect on arrival delay than <code>z_taxi_out</code>. This was not so clear in the model without transformation and is likely because depature delay has a larger range compared to taxi out time.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">vif</span>(lm.arrival<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    GVIF Df GVIF^(1/(2*Df))
z_dep_delay     1.006435  1        1.003212
z_taxi_out      1.012167  1        1.006065
OP_CARRIER_Tier 1.012168  2        1.003028</code></pre>
</div>
</div>
<p>No collinearity problem</p>
</section>
</section>
</section>
<section id="gam" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> GAM</h1>
<p>To increase flexibilty in our model we use GAM in our last created model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>gam.arrival<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">gam</span>(ARR_DELAY <span class="sc">~</span> <span class="fu">s</span>(z_dep_delay) <span class="sc">+</span> <span class="fu">s</span>(z_taxi_out, <span class="at">by =</span> OP_CARRIER_Tier) <span class="sc">+</span> OP_CARRIER_Tier, <span class="at">data =</span> planes)</span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="fu">summary</span>(gam.arrival<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="color: blue"><code>
Family: gaussian 
Link function: identity 

Formula:
ARR_DELAY ~ s(z_dep_delay) + s(z_taxi_out, by = OP_CARRIER_Tier) + 
    OP_CARRIER_Tier

Parametric coefficients:
                         Estimate Std. Error t value            Pr(&gt;|t|)    
(Intercept)                6.1165     0.1206   50.72 &lt;0.0000000000000002 ***
OP_CARRIER_TierMid-tier   -2.6551     0.1334  -19.90 &lt;0.0000000000000002 ***
OP_CARRIER_TierExpensive  -3.4284     0.1350  -25.40 &lt;0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
                                         edf Ref.df     F             p-value
s(z_dep_delay)                         7.625  8.402 99789 &lt;0.0000000000000002
s(z_taxi_out):OP_CARRIER_TierCheap     4.502  5.217  2536 &lt;0.0000000000000002
s(z_taxi_out):OP_CARRIER_TierMid-tier  5.105  6.007 11151 &lt;0.0000000000000002
s(z_taxi_out):OP_CARRIER_TierExpensive 5.317  6.154  9839 &lt;0.0000000000000002
                                          
s(z_dep_delay)                         ***
s(z_taxi_out):OP_CARRIER_TierCheap     ***
s(z_taxi_out):OP_CARRIER_TierMid-tier  ***
s(z_taxi_out):OP_CARRIER_TierExpensive ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =  0.914   Deviance explained = 91.4%
GCV = 145.54  Scale est. = 145.5     n = 96069</code></pre>
</div>
</div>
<p>We have high estimated degrees of freedom for our predictors indicating non-linearity in our relationship</p>
</section>
<section id="glm-poisson" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> GLM Poisson</h1>
<p>Airports are hectic and resources can be limited if not managed properly. Coordination is key for good resource allocation. For example to clean the interior of a plane there is only a certain time window available. Since every minute counts we aim to predict the <code>Taxi in</code> time of a plane. In the case of plane cleaning, this knowledge would help with coordination and resource allocation.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>p1<span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ARR_DELAY, <span class="at">y =</span> TAXI_IN)) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>,</span>
<span id="cb25-5"><a href="#cb25-5"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"quasipoisson"</span>),</span>
<span id="cb25-6"><a href="#cb25-6"></a>              <span class="at">formula =</span> y <span class="sc">~</span> x,</span>
<span id="cb25-7"><a href="#cb25-7"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-8"><a href="#cb25-8"></a>              <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb25-10"><a href="#cb25-10"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">""</span>,</span>
<span id="cb25-11"><a href="#cb25-11"></a>       <span class="at">x =</span> <span class="st">"ARR_DELAY"</span>,</span>
<span id="cb25-12"><a href="#cb25-12"></a>       <span class="at">y =</span> <span class="st">"Taxi In Time"</span>) </span>
<span id="cb25-13"><a href="#cb25-13"></a></span>
<span id="cb25-14"><a href="#cb25-14"></a>p2<span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span></span>
<span id="cb25-15"><a href="#cb25-15"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> DEP_DELAY, <span class="at">y =</span> TAXI_IN)) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>,</span>
<span id="cb25-18"><a href="#cb25-18"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"quasipoisson"</span>),</span>
<span id="cb25-19"><a href="#cb25-19"></a>              <span class="at">formula =</span> y <span class="sc">~</span> x,</span>
<span id="cb25-20"><a href="#cb25-20"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-21"><a href="#cb25-21"></a>              <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb25-22"><a href="#cb25-22"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb25-23"><a href="#cb25-23"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">""</span>,</span>
<span id="cb25-24"><a href="#cb25-24"></a>       <span class="at">x =</span> <span class="st">"DEP_DELAY"</span>,</span>
<span id="cb25-25"><a href="#cb25-25"></a>       <span class="at">y =</span> <span class="st">"Taxi In Time"</span>)</span>
<span id="cb25-26"><a href="#cb25-26"></a></span>
<span id="cb25-27"><a href="#cb25-27"></a>p3 <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span></span>
<span id="cb25-28"><a href="#cb25-28"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> TAXI_OUT, <span class="at">y =</span> TAXI_IN)) <span class="sc">+</span></span>
<span id="cb25-29"><a href="#cb25-29"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-30"><a href="#cb25-30"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"glm"</span>,</span>
<span id="cb25-31"><a href="#cb25-31"></a>              <span class="at">method.args =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"quasipoisson"</span>),</span>
<span id="cb25-32"><a href="#cb25-32"></a>              <span class="at">formula =</span> y <span class="sc">~</span> x,</span>
<span id="cb25-33"><a href="#cb25-33"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb25-34"><a href="#cb25-34"></a>              <span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb25-35"><a href="#cb25-35"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb25-36"><a href="#cb25-36"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">""</span>,</span>
<span id="cb25-37"><a href="#cb25-37"></a>       <span class="at">x =</span> <span class="st">"TAXI_OUT"</span>,</span>
<span id="cb25-38"><a href="#cb25-38"></a>       <span class="at">y =</span> <span class="st">"Taxi In Time"</span>)</span>
<span id="cb25-39"><a href="#cb25-39"></a></span>
<span id="cb25-40"><a href="#cb25-40"></a></span>
<span id="cb25-41"><a href="#cb25-41"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We see that <code>ARR_DELAY</code> seems to have an influence on <code>TAXI_IN</code> time. The more delayed a plane arrives the longer it takes to taxi in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>glm.poisson <span class="ot">&lt;-</span> <span class="fu">glm</span>(TAXI_IN <span class="sc">~</span> ARR_DELAY<span class="sc">*</span>OP_CARRIER_Tier,</span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="at">family =</span> <span class="st">"quasipoisson"</span>,</span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="at">data =</span> planes)</span>
<span id="cb26-4"><a href="#cb26-4"></a></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="fu">print</span>(<span class="fu">summary</span>(glm.poisson)<span class="sc">$</span>coefficients <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="color: blue"><code>                                     Estimate Std. Error    t value  Pr(&gt;|t|)
(Intercept)                         1.9777051  0.0063070 313.572945 0.0000000
ARR_DELAY                           0.0006679  0.0001187   5.627072 0.0000000
OP_CARRIER_TierMid-tier            -0.1370338  0.0070907 -19.325908 0.0000000
OP_CARRIER_TierExpensive            0.1691667  0.0069746  24.254637 0.0000000
ARR_DELAY:OP_CARRIER_TierMid-tier   0.0004641  0.0001388   3.342644 0.0008302
ARR_DELAY:OP_CARRIER_TierExpensive  0.0009579  0.0001345   7.121269 0.0000000</code></pre>
</div>
</div>
</section>
<section id="glm-binomial" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> GLM Binomial</h1>
<p><a href="Regulation%20(EC)%20261/2004">https://www.bazl.admin.ch/bazl/en/home/passagiere/air-passenger-rights/nichtbefoerderung–annullierung-und-grosse-verspaetungen/grosse-verspaetungen.html</a> states a European court of justice ruling that passengers are entitled to compensation if their flight is delayed by more than 3 hours. <em>Due to the lack of a legal basis, the FOCA is unable to fine an airline for failure to pay compensation in the event of a delay</em></p>
<p><strong>Aim: What airline has the most flights with more than 180 minutes delay and how are differences in proportions explained</strong></p>
<section id="percentage-of-flights-with-more-than-180-minutes-delay" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="percentage-of-flights-with-more-than-180-minutes-delay"><span class="header-section-number">4.1</span> Percentage of flights with more than 180 minutes delay</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>planes <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">mutate</span>(<span class="at">index_late_dep =</span> <span class="fu">ifelse</span>(DEP_DELAY <span class="sc">&gt;</span> <span class="dv">180</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">group_by</span>(OP_CARRIER) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-5"><a href="#cb28-5"></a>    <span class="at">Total_flights =</span> <span class="fu">n</span>(),</span>
<span id="cb28-6"><a href="#cb28-6"></a>    <span class="at">Total_delayed_dep =</span> <span class="fu">sum</span>(index_late_dep <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-7"><a href="#cb28-7"></a>    <span class="at">percentage_delayed_dep =</span> Total_delayed_dep <span class="sc">/</span> Total_flights <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb28-8"><a href="#cb28-8"></a>    <span class="at">Mean_dep_delay =</span> <span class="fu">mean</span>(DEP_DELAY, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-9"><a href="#cb28-9"></a>    <span class="at">Airline_tier =</span> <span class="fu">unique</span>(OP_CARRIER_Tier)</span>
<span id="cb28-10"><a href="#cb28-10"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb28-11"><a href="#cb28-11"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(percentage_delayed_dep)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-12"><a href="#cb28-12"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  OP_CARRIER Total_flights Total_delayed_dep percentage_delayed_dep
  &lt;fct&gt;              &lt;int&gt;             &lt;int&gt;                  &lt;dbl&gt;
1 OO                    27                 1                   3.70
2 WN                  1422                40                   2.81
3 FL                  5954               107                   1.80
4 XE                   890                14                   1.57
5 CO                  3666                53                   1.45
6 YV                  1041                15                   1.44
# ℹ 2 more variables: Mean_dep_delay &lt;dbl&gt;, Airline_tier &lt;fct&gt;</code></pre>
</div>
</div>
<p>We see very low percentages of flights that depart later than 180 minutes.</p>
<p>We will use aggregated data on a airline level. We will end up with 17 data points which should be kept in mind during interpretation. Furthermore, since the percentage of flights arrived 3 hours later is very low and similar. Therefore we will decrease the threshold to 30 minutes which increases the differences between airlines.</p>
<section id="aggregated-data" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="aggregated-data"><span class="header-section-number">4.1.1</span> Aggregated Data</h3>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>planes_agg <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">mutate</span>(<span class="at">index_late_dep =</span> <span class="fu">ifelse</span>(DEP_DELAY <span class="sc">&gt;</span> <span class="dv">30</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">group_by</span>(OP_CARRIER) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-5"><a href="#cb30-5"></a>    <span class="at">OP_CARRIER =</span> <span class="fu">first</span>(OP_CARRIER),</span>
<span id="cb30-6"><a href="#cb30-6"></a>    <span class="at">Total_flights =</span> <span class="fu">n</span>(),</span>
<span id="cb30-7"><a href="#cb30-7"></a>    <span class="at">Total_delayed_dep_over30 =</span> <span class="fu">sum</span>(index_late_dep <span class="sc">==</span> <span class="dv">1</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb30-8"><a href="#cb30-8"></a>    <span class="at">Total_delayed_dep_under30 =</span> <span class="fu">sum</span>(index_late_dep<span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb30-9"><a href="#cb30-9"></a>    <span class="at">Mean_dep_delay =</span> <span class="fu">mean</span>(DEP_DELAY, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb30-10"><a href="#cb30-10"></a>    <span class="at">Mean_arr_delay =</span> <span class="fu">mean</span>(ARR_DELAY, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb30-11"><a href="#cb30-11"></a>    <span class="at">Mean_distance =</span> <span class="fu">mean</span>(DISTANCE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb30-12"><a href="#cb30-12"></a>    <span class="at">Carrier_tier =</span> <span class="fu">unique</span>(OP_CARRIER_Tier),</span>
<span id="cb30-13"><a href="#cb30-13"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb30-14"><a href="#cb30-14"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>glm.late <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(Total_delayed_dep_over30, Total_delayed_dep_under30) <span class="sc">~</span> </span>
<span id="cb31-2"><a href="#cb31-2"></a>                 Carrier_tier <span class="sc">+</span> Mean_dep_delay <span class="sc">+</span> Mean_distance <span class="sc">+</span> Total_flights,</span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="at">family =</span> <span class="st">"quasibinomial"</span>,</span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="at">data =</span> <span class="fu">na.omit</span>(planes_agg))</span>
<span id="cb31-5"><a href="#cb31-5"></a></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="fu">print</span>(<span class="fu">summary</span>(glm.late)<span class="sc">$</span>coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="color: blue"><code>                             Estimate     Std. Error     t value
(Intercept)           -2.884661712402 0.185236007853 -15.5728994
Carrier_tierMid-tier   0.039102667464 0.107499989922   0.3637458
Carrier_tierExpensive -0.077424057928 0.125873286598  -0.6150952
Mean_dep_delay         0.075350839553 0.008433785936   8.9344027
Mean_distance          0.000194295108 0.000156893908   1.2383853
Total_flights          0.000004283091 0.000008836257   0.4847178
                               Pr(&gt;|t|)
(Intercept)           0.000000007676316
Carrier_tierMid-tier  0.722942397711622
Carrier_tierExpensive 0.551004409194349
Mean_dep_delay        0.000002251561208
Mean_distance         0.241350687512443
Total_flights         0.637384586921758</code></pre>
</div>
</div>
<p>Adding overdispersion to the model improves the fit. Eliminates most significant effects. There was no evidence found that airlines tiers have an influence on the proportion of flights with more than 30 minutes delay. The intercept (i.e.&nbsp;cheap tier airlines) are not interpreted, since total flights of zero is not realistic. We see that the mean departure delay has a significant effect on the proportion of flights with more than 30 minutes delay. So, an airline with a higher average departure delay has a higher proportion of flights with more than 30 minutes delay.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(glm.late)[<span class="st">"Mean_dep_delay"</span>]<span class="sc">*</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Mean_dep_delay 
          2.12 </code></pre>
</div>
</div>
<p>More specifically, the odds of airline flights being delayed by more than 30 minutes increase by 2.12 times for each 10 minutes increase in average departure delay and no evidence is found that airline tiers can explain differences in proportions of flights with more than 30 minutes delay. While interpretation one needs to keep in mind that we have few observation on the aggregated level and furthermore, both <code>Y</code> and <code>Mean_dep_delay</code> are calculated from the same data: <code>DEP_DELAY</code>.</p>
</section>
</section>
</section>
<section id="neural-network" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Neural Network</h1>
<section id="features" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="features"><span class="header-section-number">5.1</span> Features</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Include DEP_DELAY just for creating the target</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>important_features <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Month"</span>, <span class="st">"OP_CARRIER"</span>, <span class="st">"DEST"</span>, <span class="st">"CANCELLED"</span>,</span>
<span id="cb35-3"><a href="#cb35-3"></a>                        <span class="st">"CANCELLATION_CODE"</span>, <span class="st">"CRS_DEP_TIME"</span>, <span class="st">"DISTANCE"</span>, <span class="st">"DEP_DELAY"</span>)</span>
<span id="cb35-4"><a href="#cb35-4"></a></span>
<span id="cb35-5"><a href="#cb35-5"></a>planes <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span> </span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(DEP_TIME)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="fu">mutate</span>(<span class="at">delayed =</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(DEP_DELAY <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"TRUE"</span>, <span class="st">"FALSE"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-8"><a href="#cb35-8"></a>  <span class="fu">mutate</span>(<span class="at">is_weekend =</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(Weekday <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Saturday"</span>, <span class="st">"Sunday"</span>), <span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb35-9"><a href="#cb35-9"></a></span>
<span id="cb35-10"><a href="#cb35-10"></a></span>
<span id="cb35-11"><a href="#cb35-11"></a>LGA_cleaned <span class="ot">&lt;-</span> planes[important_features]</span>
<span id="cb35-12"><a href="#cb35-12"></a></span>
<span id="cb35-13"><a href="#cb35-13"></a><span class="co"># OR: Impute CANCELLED and CANCELLATION_CODE</span></span>
<span id="cb35-14"><a href="#cb35-14"></a><span class="co">#LGA_cleaned$CANCELLATION_CODE[is.na(LGA_cleaned$CANCELLATION_CODE)] &lt;- "None"</span></span>
<span id="cb35-15"><a href="#cb35-15"></a></span>
<span id="cb35-16"><a href="#cb35-16"></a></span>
<span id="cb35-17"><a href="#cb35-17"></a><span class="co"># 1. Add departure hour from CRS_DEP_TIME</span></span>
<span id="cb35-18"><a href="#cb35-18"></a>planes<span class="sc">$</span>dep_hour <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(<span class="fu">sprintf</span>(<span class="st">"%04d"</span>, planes<span class="sc">$</span>CRS_DEP_TIME), <span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb35-19"><a href="#cb35-19"></a></span>
<span id="cb35-20"><a href="#cb35-20"></a><span class="co"># 2. Bucket departure hours</span></span>
<span id="cb35-21"><a href="#cb35-21"></a>planes<span class="sc">$</span>dep_hour_bucket <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb35-22"><a href="#cb35-22"></a>  planes<span class="sc">$</span>dep_hour,</span>
<span id="cb35-23"><a href="#cb35-23"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">24</span>),</span>
<span id="cb35-24"><a href="#cb35-24"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Late Night"</span>, <span class="st">"Morning"</span>, <span class="st">"Midday"</span>, <span class="st">"Afternoon"</span>, <span class="st">"Evening"</span>)</span>
<span id="cb35-25"><a href="#cb35-25"></a>)</span>
<span id="cb35-26"><a href="#cb35-26"></a></span>
<span id="cb35-27"><a href="#cb35-27"></a>LGA_cleaned<span class="sc">$</span>FL_DATE <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(planes<span class="sc">$</span>FL_DATE[<span class="sc">!</span><span class="fu">is.na</span>(planes<span class="sc">$</span>DEP_DELAY)])</span>
<span id="cb35-28"><a href="#cb35-28"></a></span>
<span id="cb35-29"><a href="#cb35-29"></a></span>
<span id="cb35-30"><a href="#cb35-30"></a></span>
<span id="cb35-31"><a href="#cb35-31"></a><span class="co"># 5. Bucket flight distance</span></span>
<span id="cb35-32"><a href="#cb35-32"></a>planes<span class="sc">$</span>distance_bucket <span class="ot">&lt;-</span> <span class="fu">cut</span>(</span>
<span id="cb35-33"><a href="#cb35-33"></a>  planes<span class="sc">$</span>DISTANCE,</span>
<span id="cb35-34"><a href="#cb35-34"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">250</span>, <span class="dv">750</span>, <span class="dv">1500</span>, <span class="cn">Inf</span>),</span>
<span id="cb35-35"><a href="#cb35-35"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Short"</span>, <span class="st">"Medium"</span>, <span class="st">"Long"</span>, <span class="st">"Very Long"</span>)</span>
<span id="cb35-36"><a href="#cb35-36"></a>)</span>
<span id="cb35-37"><a href="#cb35-37"></a></span>
<span id="cb35-38"><a href="#cb35-38"></a><span class="co"># leakage?</span></span>
<span id="cb35-39"><a href="#cb35-39"></a><span class="co"># 6. Carrier-level delay rate</span></span>
<span id="cb35-40"><a href="#cb35-40"></a><span class="co">#carrier_delay_rate &lt;- planes %&gt;%</span></span>
<span id="cb35-41"><a href="#cb35-41"></a><span class="co">#  group_by(OP_CARRIER) %&gt;%</span></span>
<span id="cb35-42"><a href="#cb35-42"></a><span class="co">#  summarise(carrier_delay_rate = mean(as.numeric(delayed) == 1))</span></span>
<span id="cb35-43"><a href="#cb35-43"></a></span>
<span id="cb35-44"><a href="#cb35-44"></a><span class="co">#LGA_cleaned &lt;- LGA_cleaned %&gt;%</span></span>
<span id="cb35-45"><a href="#cb35-45"></a><span class="co">#  left_join(carrier_delay_rate, by = "OP_CARRIER")</span></span>
<span id="cb35-46"><a href="#cb35-46"></a></span>
<span id="cb35-47"><a href="#cb35-47"></a><span class="co"># 7. Destination-level delay rate</span></span>
<span id="cb35-48"><a href="#cb35-48"></a><span class="co">#dest_delay_rate &lt;- planes %&gt;%</span></span>
<span id="cb35-49"><a href="#cb35-49"></a><span class="co">#  group_by(DEST) %&gt;%</span></span>
<span id="cb35-50"><a href="#cb35-50"></a><span class="co">#  summarise(dest_delay_rate = mean(as.numeric(delayed) == 1))</span></span>
<span id="cb35-51"><a href="#cb35-51"></a></span>
<span id="cb35-52"><a href="#cb35-52"></a><span class="co">#LGA_cleaned &lt;- LGA_cleaned %&gt;%</span></span>
<span id="cb35-53"><a href="#cb35-53"></a><span class="co">#  left_join(dest_delay_rate, by = "DEST")</span></span>
<span id="cb35-54"><a href="#cb35-54"></a></span>
<span id="cb35-55"><a href="#cb35-55"></a><span class="co"># 🧼 Optional cleanup: remove raw dep_hour, keep bucket</span></span>
<span id="cb35-56"><a href="#cb35-56"></a>LGA_cleaned <span class="ot">&lt;-</span> planes <span class="sc">%&gt;%</span> </span>
<span id="cb35-57"><a href="#cb35-57"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Month, OP_CARRIER, DEST, CANCELLED, CANCELLATION_CODE, dep_hour_bucket, distance_bucket, delayed, is_weekend)</span>
<span id="cb35-58"><a href="#cb35-58"></a></span>
<span id="cb35-59"><a href="#cb35-59"></a><span class="co"># Make sure new categorical vars are factors</span></span>
<span id="cb35-60"><a href="#cb35-60"></a>LGA_cleaned<span class="sc">$</span>dep_hour_bucket <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(LGA_cleaned<span class="sc">$</span>dep_hour_bucket)</span>
<span id="cb35-61"><a href="#cb35-61"></a>LGA_cleaned<span class="sc">$</span>distance_bucket <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(LGA_cleaned<span class="sc">$</span>distance_bucket)</span>
<span id="cb35-62"><a href="#cb35-62"></a>LGA_cleaned<span class="sc">$</span>Month <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(LGA_cleaned<span class="sc">$</span>Month)</span>
<span id="cb35-63"><a href="#cb35-63"></a></span>
<span id="cb35-64"><a href="#cb35-64"></a></span>
<span id="cb35-65"><a href="#cb35-65"></a><span class="co"># Remove high NA columns if necessary, or impute here if needed</span></span>
<span id="cb35-66"><a href="#cb35-66"></a></span>
<span id="cb35-67"><a href="#cb35-67"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb35-68"><a href="#cb35-68"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(LGA_cleaned<span class="sc">$</span>delayed, <span class="at">p =</span> <span class="fl">0.8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-69"><a href="#cb35-69"></a>trainData <span class="ot">&lt;-</span> LGA_cleaned[trainIndex, ]</span>
<span id="cb35-70"><a href="#cb35-70"></a>testData  <span class="ot">&lt;-</span> LGA_cleaned[<span class="sc">-</span>trainIndex, ]</span>
<span id="cb35-71"><a href="#cb35-71"></a></span>
<span id="cb35-72"><a href="#cb35-72"></a><span class="co"># 2. One-hot encode all predictors</span></span>
<span id="cb35-73"><a href="#cb35-73"></a>dummies <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="sc">~</span> ., <span class="at">data =</span> trainData <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>delayed))</span>
<span id="cb35-74"><a href="#cb35-74"></a>train_x <span class="ot">&lt;-</span> <span class="fu">predict</span>(dummies, <span class="at">newdata =</span> trainData) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb35-75"><a href="#cb35-75"></a>test_x <span class="ot">&lt;-</span> <span class="fu">predict</span>(dummies, <span class="at">newdata =</span> testData) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb35-76"><a href="#cb35-76"></a><span class="fu">print</span>(<span class="fu">nrow</span>(test_x))</span>
<span id="cb35-77"><a href="#cb35-77"></a><span class="fu">print</span>(<span class="fu">nrow</span>(testData))</span>
<span id="cb35-78"><a href="#cb35-78"></a></span>
<span id="cb35-79"><a href="#cb35-79"></a><span class="co"># 3. Create y-labels</span></span>
<span id="cb35-80"><a href="#cb35-80"></a>train_y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(trainData<span class="sc">$</span>delayed) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb35-81"><a href="#cb35-81"></a>test_y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(testData<span class="sc">$</span>delayed) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb35-82"><a href="#cb35-82"></a></span>
<span id="cb35-83"><a href="#cb35-83"></a><span class="co"># 4. Remove zero-variance columns</span></span>
<span id="cb35-84"><a href="#cb35-84"></a>nzv <span class="ot">&lt;-</span> <span class="fu">nearZeroVar</span>(train_x, <span class="at">saveMetrics =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-85"><a href="#cb35-85"></a>zero_var_cols <span class="ot">&lt;-</span> <span class="fu">rownames</span>(nzv[nzv<span class="sc">$</span>zeroVar <span class="sc">==</span> <span class="cn">TRUE</span>, ])</span>
<span id="cb35-86"><a href="#cb35-86"></a>train_x <span class="ot">&lt;-</span> train_x[, <span class="sc">!</span>(<span class="fu">names</span>(train_x) <span class="sc">%in%</span> zero_var_cols)]</span>
<span id="cb35-87"><a href="#cb35-87"></a>test_x <span class="ot">&lt;-</span> test_x[, <span class="sc">!</span>(<span class="fu">names</span>(test_x) <span class="sc">%in%</span> zero_var_cols)]</span>
<span id="cb35-88"><a href="#cb35-88"></a><span class="co"># Align column structure of test_x to train_x</span></span>
<span id="cb35-89"><a href="#cb35-89"></a>missing_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(train_x), <span class="fu">names</span>(test_x))</span>
<span id="cb35-90"><a href="#cb35-90"></a><span class="cf">for</span> (col <span class="cf">in</span> missing_cols) {</span>
<span id="cb35-91"><a href="#cb35-91"></a>  test_x[[col]] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb35-92"><a href="#cb35-92"></a>}</span>
<span id="cb35-93"><a href="#cb35-93"></a><span class="co"># Also reorder the columns to match train_x</span></span>
<span id="cb35-94"><a href="#cb35-94"></a>test_x <span class="ot">&lt;-</span> test_x[, <span class="fu">names</span>(train_x)]</span>
<span id="cb35-95"><a href="#cb35-95"></a></span>
<span id="cb35-96"><a href="#cb35-96"></a><span class="co"># 5. Normalize</span></span>
<span id="cb35-97"><a href="#cb35-97"></a></span>
<span id="cb35-98"><a href="#cb35-98"></a></span>
<span id="cb35-99"><a href="#cb35-99"></a><span class="co"># Combine and convert to numeric</span></span>
<span id="cb35-100"><a href="#cb35-100"></a>train_combined <span class="ot">&lt;-</span> <span class="fu">cbind</span>(train_x, <span class="at">delayed =</span> <span class="fu">as.numeric</span>(trainData<span class="sc">$</span>delayed) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb35-101"><a href="#cb35-101"></a><span class="co"># SMOTE (on unscaled data)</span></span>
<span id="cb35-102"><a href="#cb35-102"></a>smote_result <span class="ot">&lt;-</span> <span class="fu">SMOTE</span>(<span class="at">X =</span> train_combined[, <span class="sc">-</span><span class="fu">ncol</span>(train_combined)],</span>
<span id="cb35-103"><a href="#cb35-103"></a>                      <span class="at">target =</span> train_combined<span class="sc">$</span>delayed,</span>
<span id="cb35-104"><a href="#cb35-104"></a>                      <span class="at">K =</span> <span class="dv">5</span>)</span>
<span id="cb35-105"><a href="#cb35-105"></a></span>
<span id="cb35-106"><a href="#cb35-106"></a>train_x_bal <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(smote_result<span class="sc">$</span>data[, <span class="sc">-</span><span class="fu">ncol</span>(smote_result<span class="sc">$</span>data)])</span>
<span id="cb35-107"><a href="#cb35-107"></a>train_y_bal <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(smote_result<span class="sc">$</span>data<span class="sc">$</span>class))</span>
<span id="cb35-108"><a href="#cb35-108"></a></span>
<span id="cb35-109"><a href="#cb35-109"></a><span class="co"># ✅ Now normalize AFTER SMOTE</span></span>
<span id="cb35-110"><a href="#cb35-110"></a>preProc <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(train_x_bal, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>))</span>
<span id="cb35-111"><a href="#cb35-111"></a>train_x_bal <span class="ot">&lt;-</span> <span class="fu">predict</span>(preProc, train_x_bal)</span>
<span id="cb35-112"><a href="#cb35-112"></a>test_x <span class="ot">&lt;-</span> <span class="fu">predict</span>(preProc, test_x)</span>
<span id="cb35-113"><a href="#cb35-113"></a></span>
<span id="cb35-114"><a href="#cb35-114"></a></span>
<span id="cb35-115"><a href="#cb35-115"></a><span class="co">#install_keras() </span></span>
<span id="cb35-116"><a href="#cb35-116"></a><span class="co"># Rebuild model with correct input shape</span></span>
<span id="cb35-117"><a href="#cb35-117"></a>model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-118"><a href="#cb35-118"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">64</span>, <span class="at">activation =</span> <span class="st">"relu"</span>, <span class="at">input_shape =</span> <span class="fu">ncol</span>(train_x_bal)) <span class="sc">%&gt;%</span></span>
<span id="cb35-119"><a href="#cb35-119"></a>  <span class="fu">layer_dropout</span>(<span class="at">rate =</span> <span class="fl">0.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-120"><a href="#cb35-120"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">32</span>, <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-121"><a href="#cb35-121"></a>  <span class="fu">layer_dense</span>(<span class="at">units =</span> <span class="dv">1</span>, <span class="at">activation =</span> <span class="st">"sigmoid"</span>)</span>
<span id="cb35-122"><a href="#cb35-122"></a></span>
<span id="cb35-123"><a href="#cb35-123"></a><span class="co"># Compile</span></span>
<span id="cb35-124"><a href="#cb35-124"></a>model <span class="sc">%&gt;%</span> <span class="fu">compile</span>(</span>
<span id="cb35-125"><a href="#cb35-125"></a>  <span class="at">loss =</span> <span class="st">"binary_crossentropy"</span>,</span>
<span id="cb35-126"><a href="#cb35-126"></a>  <span class="at">optimizer =</span> <span class="fu">optimizer_adam</span>(),</span>
<span id="cb35-127"><a href="#cb35-127"></a>  <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">"accuracy"</span>)</span>
<span id="cb35-128"><a href="#cb35-128"></a>)</span>
<span id="cb35-129"><a href="#cb35-129"></a></span>
<span id="cb35-130"><a href="#cb35-130"></a><span class="co"># Add early stopping callback</span></span>
<span id="cb35-131"><a href="#cb35-131"></a>early_stop <span class="ot">&lt;-</span> <span class="fu">callback_early_stopping</span>(</span>
<span id="cb35-132"><a href="#cb35-132"></a>  <span class="at">monitor =</span> <span class="st">"val_loss"</span>,</span>
<span id="cb35-133"><a href="#cb35-133"></a>  <span class="at">patience =</span> <span class="dv">5</span>,</span>
<span id="cb35-134"><a href="#cb35-134"></a>  <span class="at">restore_best_weights =</span> <span class="cn">TRUE</span></span>
<span id="cb35-135"><a href="#cb35-135"></a>)</span>
<span id="cb35-136"><a href="#cb35-136"></a></span>
<span id="cb35-137"><a href="#cb35-137"></a><span class="co"># Since ROSE is used, set equal class weights</span></span>
<span id="cb35-138"><a href="#cb35-138"></a></span>
<span id="cb35-139"><a href="#cb35-139"></a></span>
<span id="cb35-140"><a href="#cb35-140"></a><span class="co"># Train model</span></span>
<span id="cb35-141"><a href="#cb35-141"></a>history <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb35-142"><a href="#cb35-142"></a>  <span class="at">x =</span> <span class="fu">as.matrix</span>(train_x_bal),</span>
<span id="cb35-143"><a href="#cb35-143"></a>  <span class="at">y =</span> train_y_bal,</span>
<span id="cb35-144"><a href="#cb35-144"></a>  <span class="at">epochs =</span> <span class="dv">50</span>,</span>
<span id="cb35-145"><a href="#cb35-145"></a>  <span class="at">batch_size =</span> <span class="dv">32</span>,</span>
<span id="cb35-146"><a href="#cb35-146"></a>  <span class="at">validation_split =</span> <span class="fl">0.2</span>,</span>
<span id="cb35-147"><a href="#cb35-147"></a>  <span class="at">callbacks =</span> <span class="fu">list</span>(early_stop)</span>
<span id="cb35-148"><a href="#cb35-148"></a>)</span>
<span id="cb35-149"><a href="#cb35-149"></a></span>
<span id="cb35-150"><a href="#cb35-150"></a></span>
<span id="cb35-151"><a href="#cb35-151"></a></span>
<span id="cb35-152"><a href="#cb35-152"></a><span class="co"># Predict probabilities</span></span>
<span id="cb35-153"><a href="#cb35-153"></a>pred_probs <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(model <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="fu">as.matrix</span>(test_x)))</span>
<span id="cb35-154"><a href="#cb35-154"></a></span>
<span id="cb35-155"><a href="#cb35-155"></a><span class="co"># Get optimized threshold</span></span>
<span id="cb35-156"><a href="#cb35-156"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(testData<span class="sc">$</span>delayed, pred_probs)</span>
<span id="cb35-157"><a href="#cb35-157"></a>best_thresh <span class="ot">&lt;-</span> <span class="fu">coords</span>(roc_obj, <span class="st">"best"</span>, <span class="at">ret =</span> <span class="st">"threshold"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb35-158"><a href="#cb35-158"></a></span>
<span id="cb35-159"><a href="#cb35-159"></a></span>
<span id="cb35-160"><a href="#cb35-160"></a><span class="co"># Classify using that threshold</span></span>
<span id="cb35-161"><a href="#cb35-161"></a>pred_classes <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_probs <span class="sc">&gt;</span> best_thresh, <span class="st">"TRUE"</span>, <span class="st">"FALSE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># Evaluate</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="fu">confusionMatrix</span>(</span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">factor</span>(pred_classes, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span>, <span class="st">"TRUE"</span>)),</span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">factor</span>(testData<span class="sc">$</span>delayed, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span>, <span class="st">"TRUE"</span>))</span>
<span id="cb36-5"><a href="#cb36-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre style="color: blue"><code>Confusion Matrix and Statistics

          Reference
Prediction FALSE TRUE
     FALSE  5877 1423
     TRUE   7758 4229
                                             
               Accuracy : 0.524              
                 95% CI : (0.5169, 0.5311)   
    No Information Rate : 0.707              
    P-Value [Acc &gt; NIR] : 1                  
                                             
                  Kappa : 0.135              
                                             
 Mcnemar's Test P-Value : &lt;0.0000000000000002
                                             
            Sensitivity : 0.4310             
            Specificity : 0.7482             
         Pos Pred Value : 0.8051             
         Neg Pred Value : 0.3528             
             Prevalence : 0.7070             
         Detection Rate : 0.3047             
   Detection Prevalence : 0.3785             
      Balanced Accuracy : 0.5896             
                                             
       'Positive' Class : FALSE              
                                             </code></pre>
</div>
</div>
<p>During the development of a neural network to classify whether a flight would be delayed or not, several limitations of both the dataset and the model became apparent: Since only data from a single airport (LGA) was used, the variety in operational conditions and causes of delay was inherently limited. The available features provided insufficient variance to reliably distinguish outliers (i.e., delayed flights). Derived features — such as binned departure hours, distance categories, and carrier-specific delay rates — yielded only marginal performance improvements. Simple models lacked the capacity to learn meaningful patterns from the data. More complex models performed better on the training data but showed clear signs of overfitting. Despite various optimization efforts, including feature engineering, class balancing, and threshold tuning, the model’s maximum Kappa score remained around 0.28. This indicates limited predictive value and insufficient reliability for real-world application.</p>
</section>
</section>
<section id="support-vector-machine" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Support Vector Machine</h1>
<section id="eda-and-data-preprocessing" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="eda-and-data-preprocessing"><span class="header-section-number">6.1</span> EDA and Data Preprocessing</h2>
<section id="selecting-the-target-variable" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="selecting-the-target-variable"><span class="header-section-number">6.1.1</span> Selecting the Target Variable</h3>
<p>The first step involves selecting the dependent variable for classification using the Support Vector Machine (SVM) model. From a customer-oriented perspective, a key concern is whether a flight will arrive on time or experience a delay. The dataset includes a column labeled ARR_DELAY, which records the total delay in minutes upon arrival. To proceed, it is essential to examine the distribution of arrival delays in the dataset.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>planes_initial_svm <span class="ot">&lt;-</span> planes</span>
<span id="cb38-2"><a href="#cb38-2"></a></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="fu">hist</span>(planes_initial_svm<span class="sc">$</span>ARR_DELAY,</span>
<span id="cb38-4"><a href="#cb38-4"></a>     <span class="at">main =</span> <span class="st">"Histogram of Arrival Delays"</span>,</span>
<span id="cb38-5"><a href="#cb38-5"></a>     <span class="at">xlab =</span> <span class="st">"Arrival Delay (minutes)"</span>,</span>
<span id="cb38-6"><a href="#cb38-6"></a>     <span class="at">col =</span> <span class="st">"skyblue"</span>,</span>
<span id="cb38-7"><a href="#cb38-7"></a>     <span class="at">border =</span> <span class="st">"white"</span>,</span>
<span id="cb38-8"><a href="#cb38-8"></a>     <span class="at">breaks =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(planes_initial_svm<span class="sc">$</span>ARR_DELAY, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-2"><a href="#cb39-2"></a>     <span class="at">main =</span> <span class="st">"Density Plot of Arrival Delays"</span>,</span>
<span id="cb39-3"><a href="#cb39-3"></a>     <span class="at">xlab =</span> <span class="st">"Arrival Delay (minutes)"</span>,</span>
<span id="cb39-4"><a href="#cb39-4"></a>     <span class="at">col =</span> <span class="st">"darkgreen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plotted data indicates that arrival delays are relatively symmetrically distributed around zero, with some degree of variation. While a small number of flights experience significant delays, early arrivals are less extreme in comparison. Given that this study employs a classification approach—transforming continuous delay values into categorical labels—the impact of such outliers is mitigated. Unlike regression tasks, where precise delay durations significantly affect the model, classification focuses on threshold-based categorization, reducing the influence of extreme values.</p>
<p>The next step involves preprocessing the dataset by introducing a new binary target column. This column assigns a value of 1 to flights with an arrival delay greater than zero, indicating a delayed arrival, and a value of 0 to flights that arrived on time or early (arrival delay less than or equal to zero).</p>
<p>To evaluate the balance of the newly created target variable, we analyzeits class distribution. This allows us to assess the proportion of delayed versus non-delayed flights in the dataset.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(planes_initial_svm<span class="sc">$</span>DELAYED))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">length</span>(planes_initial_svm<span class="sc">$</span>DELAYED)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>planes_initial_svm<span class="sc">$</span>DELAYED <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(planes_initial_svm<span class="sc">$</span>ARR_DELAY <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb44-2"><a href="#cb44-2"></a></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="fu">barplot</span>(<span class="fu">table</span>(planes_initial_svm<span class="sc">$</span>DELAYED),</span>
<span id="cb44-4"><a href="#cb44-4"></a>        <span class="at">names.arg =</span> <span class="fu">c</span>(<span class="st">"On Time (0)"</span>, <span class="st">"Delayed (1)"</span>),</span>
<span id="cb44-5"><a href="#cb44-5"></a>        <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"lightgreen"</span>, <span class="st">"salmon"</span>),</span>
<span id="cb44-6"><a href="#cb44-6"></a>        <span class="at">main =</span> <span class="st">"Distribution of Flight Delays"</span>,</span>
<span id="cb44-7"><a href="#cb44-7"></a>        <span class="at">ylab =</span> <span class="st">"Number of Flights"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="fu">pie</span>(<span class="fu">table</span>(planes_initial_svm<span class="sc">$</span>DELAYED),</span>
<span id="cb45-2"><a href="#cb45-2"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"On Time"</span>, <span class="st">"Delayed"</span>),</span>
<span id="cb45-3"><a href="#cb45-3"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"orange"</span>),</span>
<span id="cb45-4"><a href="#cb45-4"></a>    <span class="at">main =</span> <span class="st">"Proportion of Delayed Flights"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="fu">mean</span>(planes_initial_svm<span class="sc">$</span>DELAYED, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.3675691</code></pre>
</div>
</div>
<p>The plot shows that 36.75% of the flights are classified as delayed. This indicates a reasonably balanced distribution between delayed and non-delayed flights, which is suitable for training a classification model like SVM.</p>
</section>
<section id="feature-selection-engineering" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="feature-selection-engineering"><span class="header-section-number">6.1.2</span> Feature Selection &amp; Engineering</h3>
<p>Consistent with the approach used in the linear model, airlines are categorized into three pricing tiers: low-cost, mid-tier, and premium carriers.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>planes_initial_svm <span class="ot">&lt;-</span> planes_initial_svm <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">OP_CARRIER_Tier =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(OP_CARRIER,</span>
<span id="cb48-3"><a href="#cb48-3"></a>    <span class="co"># Expensive</span></span>
<span id="cb48-4"><a href="#cb48-4"></a>    <span class="st">"AA"</span> <span class="ot">=</span> <span class="st">"Expensive"</span>,</span>
<span id="cb48-5"><a href="#cb48-5"></a>    <span class="st">"DL"</span> <span class="ot">=</span> <span class="st">"Expensive"</span>,</span>
<span id="cb48-6"><a href="#cb48-6"></a>    <span class="st">"UA"</span> <span class="ot">=</span> <span class="st">"Expensive"</span>,</span>
<span id="cb48-7"><a href="#cb48-7"></a>    <span class="st">"CO"</span> <span class="ot">=</span> <span class="st">"Expensive"</span>,</span>
<span id="cb48-8"><a href="#cb48-8"></a></span>
<span id="cb48-9"><a href="#cb48-9"></a>    <span class="co"># Cheap</span></span>
<span id="cb48-10"><a href="#cb48-10"></a>    <span class="st">"B6"</span> <span class="ot">=</span> <span class="st">"Cheap"</span>,</span>
<span id="cb48-11"><a href="#cb48-11"></a>    <span class="st">"F9"</span> <span class="ot">=</span> <span class="st">"Cheap"</span>,</span>
<span id="cb48-12"><a href="#cb48-12"></a>    <span class="st">"FL"</span> <span class="ot">=</span> <span class="st">"Cheap"</span>,</span>
<span id="cb48-13"><a href="#cb48-13"></a>    <span class="st">"WN"</span> <span class="ot">=</span> <span class="st">"Cheap"</span>,</span>
<span id="cb48-14"><a href="#cb48-14"></a></span>
<span id="cb48-15"><a href="#cb48-15"></a>    <span class="co"># Mid-tier</span></span>
<span id="cb48-16"><a href="#cb48-16"></a>    <span class="st">"9E"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb48-17"><a href="#cb48-17"></a>    <span class="st">"EV"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb48-18"><a href="#cb48-18"></a>    <span class="st">"MQ"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb48-19"><a href="#cb48-19"></a>    <span class="st">"OH"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb48-20"><a href="#cb48-20"></a>    <span class="st">"OO"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb48-21"><a href="#cb48-21"></a>    <span class="st">"XE"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb48-22"><a href="#cb48-22"></a>    <span class="st">"YV"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb48-23"><a href="#cb48-23"></a>    <span class="st">"NW"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb48-24"><a href="#cb48-24"></a>    <span class="st">"US"</span> <span class="ot">=</span> <span class="st">"Mid-tier"</span>,</span>
<span id="cb48-25"><a href="#cb48-25"></a></span>
<span id="cb48-26"><a href="#cb48-26"></a>    <span class="at">.default =</span> <span class="cn">NA_character_</span></span>
<span id="cb48-27"><a href="#cb48-27"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb48-28"><a href="#cb48-28"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">OP_CARRIER_Tier =</span> <span class="fu">factor</span>(OP_CARRIER_Tier, </span>
<span id="cb48-29"><a href="#cb48-29"></a>                                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Cheap"</span>, <span class="st">"Mid-tier"</span>, <span class="st">"Expensive"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A key requirement for the SVM classification task is to limit input features to those available prior to flight departure. This ensures that the model operates under realistic conditions where only pre-departure information is accessible. Accordingly, the initial set of features will be selected based on their availability before takeoff.:</p>
<table class="table">
<colgroup>
<col style="width: 19%">
<col style="width: 10%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Class</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FL_DATE</td>
<td>Date</td>
<td>Date of the flight (yy/mm/dd)</td>
</tr>
<tr class="even">
<td>OP_CARRIER</td>
<td>character</td>
<td>Airline Identifier</td>
</tr>
<tr class="odd">
<td>OP_CARRIER_FL_NUM</td>
<td>integer</td>
<td>Flight Number</td>
</tr>
<tr class="even">
<td>DEST</td>
<td>character</td>
<td>Destination Airport Code</td>
</tr>
<tr class="odd">
<td>CRS_DEP_TIME</td>
<td>Date</td>
<td>Planned Departure Time (HH:MM)</td>
</tr>
<tr class="even">
<td>CRS_ARR_TIME</td>
<td>Date</td>
<td>Planned Arrival Time</td>
</tr>
<tr class="odd">
<td>CRS_ELAPSED_TIME</td>
<td>integer</td>
<td>Planned time amount needed for the flight trip</td>
</tr>
<tr class="even">
<td>DISTANCE</td>
<td>integer</td>
<td>Distance between two airports</td>
</tr>
<tr class="odd">
<td>OP_CARRIER_Tier</td>
<td>character</td>
<td>Category of carrier (e.g., major, regional)</td>
</tr>
<tr class="even">
<td>DELAYED</td>
<td>integer</td>
<td>Target: 1 if ARR_DELAY &gt; 0, else 0</td>
</tr>
</tbody>
</table>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="co">#|echo: false</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>planes_svm <span class="ot">&lt;-</span> planes_initial_svm[, <span class="fu">c</span>(<span class="st">"FL_DATE"</span>,</span>
<span id="cb49-3"><a href="#cb49-3"></a>                         <span class="st">"OP_CARRIER_FL_NUM"</span>,</span>
<span id="cb49-4"><a href="#cb49-4"></a>                         <span class="st">"DEST"</span>,</span>
<span id="cb49-5"><a href="#cb49-5"></a>                         <span class="st">"CRS_DEP_TIME"</span>,</span>
<span id="cb49-6"><a href="#cb49-6"></a>                         <span class="st">"CRS_ARR_TIME"</span>,</span>
<span id="cb49-7"><a href="#cb49-7"></a>                         <span class="st">"CRS_ELAPSED_TIME"</span>,</span>
<span id="cb49-8"><a href="#cb49-8"></a>                         <span class="st">"DISTANCE"</span>,</span>
<span id="cb49-9"><a href="#cb49-9"></a>                         <span class="st">"OP_CARRIER_Tier"</span>,</span>
<span id="cb49-10"><a href="#cb49-10"></a>                         <span class="st">"DELAYED"</span>)]</span>
<span id="cb49-11"><a href="#cb49-11"></a></span>
<span id="cb49-12"><a href="#cb49-12"></a>planes_svm <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(planes_svm)</span>
<span id="cb49-13"><a href="#cb49-13"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(planes_svm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>The OP_CARRIER feature is excluded from the model, as its information is sufficiently represented by the OP_CARRIER_Tier variable. To prepare OP_CARRIER_Tier for use in the SVM classifier, one-hot encoding is applied. This converts the categorical tier levels into a numerical format appropriate for classification.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>planes_svm <span class="ot">&lt;-</span> <span class="fu">cbind</span>(planes_svm, <span class="fu">model.matrix</span>(<span class="sc">~</span> OP_CARRIER_Tier <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> planes_svm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To utilize the date-related columns effectively, an appropriate transformation strategy must be established. Initially, the FL_DATE field is categorized into two temporal dimensions: weekday versus weekend, and calendar quarters. The use of calendar quarters is chosen over seasonal labels, as seasonal patterns vary significantly across different regions of the United States.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>planes_svm<span class="sc">$</span>DayType <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">weekdays</span>(planes_svm<span class="sc">$</span>FL_DATE) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Saturday"</span>, <span class="st">"Sunday"</span>),</span>
<span id="cb52-2"><a href="#cb52-2"></a>                             <span class="st">"Weekend"</span>, <span class="st">"Weekday"</span>)</span>
<span id="cb52-3"><a href="#cb52-3"></a>planes_svm<span class="sc">$</span>Quarter <span class="ot">&lt;-</span> <span class="fu">quarters</span>(planes_svm<span class="sc">$</span>FL_DATE)</span>
<span id="cb52-4"><a href="#cb52-4"></a></span>
<span id="cb52-5"><a href="#cb52-5"></a>planes_svm<span class="sc">$</span>DayType <span class="ot">&lt;-</span> <span class="fu">factor</span>(planes_svm<span class="sc">$</span>DayType, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Weekday"</span>, <span class="st">"Weekend"</span>))</span>
<span id="cb52-6"><a href="#cb52-6"></a>planes_svm<span class="sc">$</span>Quarter <span class="ot">&lt;-</span> <span class="fu">factor</span>(planes_svm<span class="sc">$</span>Quarter, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>))</span>
<span id="cb52-7"><a href="#cb52-7"></a>daytype_dummies <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> DayType <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> planes_svm)</span>
<span id="cb52-8"><a href="#cb52-8"></a>quarter_dummies <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> Quarter <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> planes_svm)</span>
<span id="cb52-9"><a href="#cb52-9"></a>planes_svm <span class="ot">&lt;-</span> <span class="fu">cbind</span>(planes_svm, daytype_dummies, quarter_dummies)</span>
<span id="cb52-10"><a href="#cb52-10"></a>planes_svm<span class="sc">$</span>DayType <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb52-11"><a href="#cb52-11"></a>planes_svm<span class="sc">$</span>Quarter <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For the scheduled departure time (CRS_DEP_TIME) and scheduled arrival time (CRS_ARR_TIME) we will use cyclical encoding (see https://scholarworks.calstate.edu/downloads/pv63g5147).</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>to_minutes <span class="ot">&lt;-</span> <span class="cf">function</span>(hhmm) {</span>
<span id="cb53-2"><a href="#cb53-2"></a>  hours <span class="ot">&lt;-</span> hhmm <span class="sc">%/%</span> <span class="dv">100</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>  minutes <span class="ot">&lt;-</span> hhmm <span class="sc">%%</span> <span class="dv">100</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>  <span class="fu">return</span>(hours <span class="sc">*</span> <span class="dv">60</span> <span class="sc">+</span> minutes)</span>
<span id="cb53-5"><a href="#cb53-5"></a>}</span>
<span id="cb53-6"><a href="#cb53-6"></a></span>
<span id="cb53-7"><a href="#cb53-7"></a>planes_svm<span class="sc">$</span>DEP_MIN <span class="ot">&lt;-</span> <span class="fu">to_minutes</span>(planes_svm<span class="sc">$</span>CRS_DEP_TIME)</span>
<span id="cb53-8"><a href="#cb53-8"></a>planes_svm<span class="sc">$</span>ARR_MIN <span class="ot">&lt;-</span> <span class="fu">to_minutes</span>(planes_svm<span class="sc">$</span>CRS_ARR_TIME)</span>
<span id="cb53-9"><a href="#cb53-9"></a>max_minutes <span class="ot">&lt;-</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">60</span>  <span class="co"># total minutes in a day</span></span>
<span id="cb53-10"><a href="#cb53-10"></a>planes_svm<span class="sc">$</span>DEP_SIN <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> planes_svm<span class="sc">$</span>DEP_MIN <span class="sc">/</span> max_minutes)</span>
<span id="cb53-11"><a href="#cb53-11"></a>planes_svm<span class="sc">$</span>DEP_COS <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> planes_svm<span class="sc">$</span>DEP_MIN <span class="sc">/</span> max_minutes)</span>
<span id="cb53-12"><a href="#cb53-12"></a>planes_svm<span class="sc">$</span>ARR_SIN <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> planes_svm<span class="sc">$</span>ARR_MIN <span class="sc">/</span> max_minutes)</span>
<span id="cb53-13"><a href="#cb53-13"></a>planes_svm<span class="sc">$</span>ARR_COS <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> planes_svm<span class="sc">$</span>ARR_MIN <span class="sc">/</span> max_minutes)</span>
<span id="cb53-14"><a href="#cb53-14"></a></span>
<span id="cb53-15"><a href="#cb53-15"></a>planes_svm <span class="ot">&lt;-</span> <span class="fu">subset</span>(planes_svm, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(CRS_DEP_TIME, CRS_ARR_TIME, DEP_MIN, ARR_MIN))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It would be interesting to also utilize the destination codes. Lets analyze the distribution of the destionation codes.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(planes_svm<span class="sc">$</span>DEST))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>dest_counts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(planes_svm<span class="sc">$</span>DEST))</span>
<span id="cb56-2"><a href="#cb56-2"></a><span class="fu">ggplot</span>(dest_counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Var1, <span class="sc">-</span>Freq), <span class="at">y =</span> Freq)) <span class="sc">+</span></span>
<span id="cb56-3"><a href="#cb56-3"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Flight Counts by Destination"</span>,</span>
<span id="cb56-5"><a href="#cb56-5"></a>       <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb56-6"><a href="#cb56-6"></a>       <span class="at">y =</span> <span class="st">"Number of Flights"</span>) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb56-8"><a href="#cb56-8"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb56-9"><a href="#cb56-9"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The dataset includes 60 unique destination airports, exhibiting a long-tail distribution in terms of frequency. To manage this categorical feature effectively, destinations are first grouped based on traffic volume before applying one-hot encoding. Specifically, the eight most frequent destination airports are classified as “high-frequency,” while the remaining airports are grouped into an “other” category.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>dest_freq <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">table</span>(planes_svm<span class="sc">$</span>DEST), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-2"><a href="#cb57-2"></a>top_10_dest <span class="ot">&lt;-</span> <span class="fu">names</span>(dest_freq)[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb57-3"><a href="#cb57-3"></a>planes_svm<span class="sc">$</span>DEST_GROUPED <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(planes_svm<span class="sc">$</span>DEST <span class="sc">%in%</span> top_10_dest, <span class="st">"High"</span>, <span class="st">"Other"</span>)</span>
<span id="cb57-4"><a href="#cb57-4"></a>planes_svm<span class="sc">$</span>DEST_GROUPED <span class="ot">&lt;-</span> <span class="fu">factor</span>(planes_svm<span class="sc">$</span>DEST_GROUPED, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Other"</span>, <span class="st">"High"</span>))</span>
<span id="cb57-5"><a href="#cb57-5"></a></span>
<span id="cb57-6"><a href="#cb57-6"></a></span>
<span id="cb57-7"><a href="#cb57-7"></a><span class="fu">ggplot</span>(planes_svm, <span class="fu">aes</span>(<span class="at">x =</span> DEST_GROUPED)) <span class="sc">+</span></span>
<span id="cb57-8"><a href="#cb57-8"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"tomato"</span>) <span class="sc">+</span></span>
<span id="cb57-9"><a href="#cb57-9"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Destination Tiers"</span>,</span>
<span id="cb57-10"><a href="#cb57-10"></a>       <span class="at">x =</span> <span class="st">"Destination Tier"</span>,</span>
<span id="cb57-11"><a href="#cb57-11"></a>       <span class="at">y =</span> <span class="st">"Number of Flights"</span>) <span class="sc">+</span></span>
<span id="cb57-12"><a href="#cb57-12"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="main_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Visual inspection of the resulting distribution reveals a relatively balanced split between the two groups, supporting the decision to proceed with this categorization. Let’s one-hot encode the destination group and remove redundant columns. Redundant columns, including the original destination identifier and the carrier flight number, are removed, as they do not contribute meaningful predictive value.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>dest_dummies <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> DEST_GROUPED <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> planes_svm)</span>
<span id="cb58-2"><a href="#cb58-2"></a>planes_svm <span class="ot">&lt;-</span> <span class="fu">cbind</span>(planes_svm, dest_dummies)</span>
<span id="cb58-3"><a href="#cb58-3"></a>planes_svm<span class="sc">$</span>DEST_GROUPED <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb58-4"><a href="#cb58-4"></a>planes_svm<span class="sc">$</span>DEST <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb58-5"><a href="#cb58-5"></a>planes_svm<span class="sc">$</span>FL_DATE <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb58-6"><a href="#cb58-6"></a>planes_svm<span class="sc">$</span>OP_CARRIER_FL_NUM <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb58-7"><a href="#cb58-7"></a>planes_svm<span class="sc">$</span>OP_CARRIER_Tier <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>At this stage, the final set of features is defined.</p>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 9%">
<col style="width: 68%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Class</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CRS_ELAPSED_TIME</td>
<td>integer</td>
<td>Planned time amount needed for the flight trip</td>
</tr>
<tr class="even">
<td>DISTANCE</td>
<td>integer</td>
<td>Distance between two airports</td>
</tr>
<tr class="odd">
<td>DELAYED</td>
<td>integer</td>
<td>Target: 1 if ARR_DELAY &gt; 0, else 0</td>
</tr>
<tr class="even">
<td>OP_CARRIER_Tier_*</td>
<td>numeric</td>
<td>One-hot encoded carrier category (e.g., major, regional, low-cost)</td>
</tr>
<tr class="odd">
<td>DayType_*</td>
<td>numeric</td>
<td>One-hot encoded day type (Weekday, Weekend)</td>
</tr>
<tr class="even">
<td>Quarter_*</td>
<td>numeric</td>
<td>One-hot encoded calendar quarter (Q1–Q4)</td>
</tr>
<tr class="odd">
<td>DEP_SIN, DEP_COS</td>
<td>numeric</td>
<td>Cyclical encoding of scheduled departure time</td>
</tr>
<tr class="even">
<td>ARR_SIN, ARR_COS</td>
<td>numeric</td>
<td>Cyclical encoding of scheduled arrival time</td>
</tr>
<tr class="odd">
<td>DEST_GROUPEDHigh</td>
<td>numeric</td>
<td>One-hot encoded indicator for high-traffic destinations</td>
</tr>
</tbody>
</table>
<p>Now the data is ready train and test a svm to predict DELAYED. All features are then normalized to ensure they are on a consistent scale. We will choose z-score scaling, but after splitting the data see https://forecastegy.com/posts/does-svm-need-feature-scaling-or-normalization/</p>
</section>
</section>
<section id="svm-modeling" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="svm-modeling"><span class="header-section-number">6.2</span> SVM Modeling</h2>
<p>To conduct an initial performance evaluation, the SVM model is trained using the caret package with the e1071 implementation. Given the size of the dataset, a 50% subset is used to reduce computational time during training. The tuneLength parameter is set to 3, combined with 5-fold cross-validation, to enable a quick, preliminary analysis of model performance while minimizing training overhead.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb59-2"><a href="#cb59-2"></a>planes_svm <span class="ot">&lt;-</span> planes_svm[<span class="fu">sample</span>(<span class="fu">nrow</span>(planes_svm)), ]</span>
<span id="cb59-3"><a href="#cb59-3"></a></span>
<span id="cb59-4"><a href="#cb59-4"></a>svm_train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(planes_svm<span class="sc">$</span>DELAYED, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-5"><a href="#cb59-5"></a>svm_train_data <span class="ot">&lt;-</span> planes_svm[svm_train_index, ]</span>
<span id="cb59-6"><a href="#cb59-6"></a>svm_test_data  <span class="ot">&lt;-</span> planes_svm[<span class="sc">-</span>svm_train_index, ]</span>
<span id="cb59-7"><a href="#cb59-7"></a></span>
<span id="cb59-8"><a href="#cb59-8"></a>subset_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(svm_train_data<span class="sc">$</span>DELAYED, <span class="at">p =</span> <span class="fl">0.3</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-9"><a href="#cb59-9"></a>svm_train_data <span class="ot">&lt;-</span> svm_train_data[subset_index, ]</span>
<span id="cb59-10"><a href="#cb59-10"></a></span>
<span id="cb59-11"><a href="#cb59-11"></a>svm_train_data<span class="sc">$</span>DELAYED <span class="ot">&lt;-</span> <span class="fu">factor</span>(svm_train_data<span class="sc">$</span>DELAYED, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>))</span>
<span id="cb59-12"><a href="#cb59-12"></a>svm_test_data<span class="sc">$</span>DELAYED  <span class="ot">&lt;-</span> <span class="fu">factor</span>(svm_test_data<span class="sc">$</span>DELAYED, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>))</span>
<span id="cb59-13"><a href="#cb59-13"></a></span>
<span id="cb59-14"><a href="#cb59-14"></a>preds <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(svm_train_data), <span class="st">"DELAYED"</span>)</span>
<span id="cb59-15"><a href="#cb59-15"></a></span>
<span id="cb59-16"><a href="#cb59-16"></a>train_scaled   <span class="ot">&lt;-</span> <span class="fu">scale</span>(svm_train_data[preds])</span>
<span id="cb59-17"><a href="#cb59-17"></a>scaling_params <span class="ot">&lt;-</span> <span class="fu">attributes</span>(train_scaled)</span>
<span id="cb59-18"><a href="#cb59-18"></a><span class="co">#   scaling_params$`scaled:center`  = per-feature means</span></span>
<span id="cb59-19"><a href="#cb59-19"></a><span class="co">#   scaling_params$`scaled:scale`   = per-feature sds</span></span>
<span id="cb59-20"><a href="#cb59-20"></a></span>
<span id="cb59-21"><a href="#cb59-21"></a>svm_train_data[preds] <span class="ot">&lt;-</span> train_scaled</span>
<span id="cb59-22"><a href="#cb59-22"></a></span>
<span id="cb59-23"><a href="#cb59-23"></a>svm_test_data[preds] <span class="ot">&lt;-</span> <span class="fu">scale</span>(</span>
<span id="cb59-24"><a href="#cb59-24"></a>  svm_test_data[preds],</span>
<span id="cb59-25"><a href="#cb59-25"></a>  <span class="at">center =</span> scaling_params<span class="sc">$</span><span class="st">`</span><span class="at">scaled:center</span><span class="st">`</span>,</span>
<span id="cb59-26"><a href="#cb59-26"></a>  <span class="at">scale  =</span> scaling_params<span class="sc">$</span><span class="st">`</span><span class="at">scaled:scale</span><span class="st">`</span></span>
<span id="cb59-27"><a href="#cb59-27"></a>)</span>
<span id="cb59-28"><a href="#cb59-28"></a></span>
<span id="cb59-29"><a href="#cb59-29"></a></span>
<span id="cb59-30"><a href="#cb59-30"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb59-31"><a href="#cb59-31"></a>                              <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb59-32"><a href="#cb59-32"></a>                              <span class="at">verboseIter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb59-33"><a href="#cb59-33"></a>                              <span class="at">allowParallel =</span> <span class="cn">FALSE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># svm_model &lt;- train(DELAYED ~ ., </span></span>
<span id="cb60-2"><a href="#cb60-2"></a><span class="co">#                   data = svm_train_data,</span></span>
<span id="cb60-3"><a href="#cb60-3"></a><span class="co">#                   method = "svmRadial",</span></span>
<span id="cb60-4"><a href="#cb60-4"></a><span class="co">#                   trControl = train_control,</span></span>
<span id="cb60-5"><a href="#cb60-5"></a><span class="co">#                   tuneLength = 3,</span></span>
<span id="cb60-6"><a href="#cb60-6"></a><span class="co">#                   preProcess = NULL</span></span>
<span id="cb60-7"><a href="#cb60-7"></a><span class="co">#                   )</span></span>
<span id="cb60-8"><a href="#cb60-8"></a><span class="co">#saveRDS(svm_model, file = "../Models/svm_model.rds")</span></span>
<span id="cb60-9"><a href="#cb60-9"></a><span class="co"># Load model</span></span>
<span id="cb60-10"><a href="#cb60-10"></a>svm_model <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Models/svm_model.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="co">#| attr-output: "style='color: blue'"</span></span>
<span id="cb61-2"><a href="#cb61-2"></a></span>
<span id="cb61-3"><a href="#cb61-3"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(svm_model, <span class="at">newdata =</span> svm_test_data)</span>
<span id="cb61-4"><a href="#cb61-4"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions, svm_test_data<span class="sc">$</span>DELAYED, <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb61-5"><a href="#cb61-5"></a><span class="fu">print</span>(conf_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0 16817  8416
         1  1635  1952
                                               
               Accuracy : 0.6512               
                 95% CI : (0.6457, 0.6568)     
    No Information Rate : 0.6402               
    P-Value [Acc &gt; NIR] : 0.00004952           
                                               
                  Kappa : 0.1163               
                                               
 Mcnemar's Test P-Value : &lt; 0.00000000000000022
                                               
            Sensitivity : 0.18827              
            Specificity : 0.91139              
         Pos Pred Value : 0.54419              
         Neg Pred Value : 0.66647              
             Prevalence : 0.35975              
         Detection Rate : 0.06773              
   Detection Prevalence : 0.12446              
      Balanced Accuracy : 0.54983              
                                               
       'Positive' Class : 1                    
                                               </code></pre>
</div>
</div>
<p>The Support Vector Machine (SVM) model achieved an accuracy of 64.58%, which is only marginally higher than the no-information rate of 63.05%. However, since the primary objective is to identify delayed flights, overall accuracy is less meaningful due to class imbalance. The model demonstrates high specificity (92.74%)—indicating strong performance in recognizing non-delayed flights—but its sensitivity is critically low at 16.5%, highlighting a substantial weakness in detecting the target class (delays). The balanced accuracy of 54.6% and a low kappa of 0.1087 further emphasize the model’s poor discriminatory power for delayed flights. To address this, the next step is to apply downsampling (via sampling = “down”) to reduce the dominance of the majority class and improve the model’s ability to correctly identify delayed flights.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co">#set.seed(123)</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="co">#| echo: false</span></span>
<span id="cb63-3"><a href="#cb63-3"></a></span>
<span id="cb63-4"><a href="#cb63-4"></a>train_control <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>,</span>
<span id="cb63-5"><a href="#cb63-5"></a>                              <span class="at">number =</span> <span class="dv">5</span>,</span>
<span id="cb63-6"><a href="#cb63-6"></a>                              <span class="at">sampling =</span> <span class="st">"down"</span>,   </span>
<span id="cb63-7"><a href="#cb63-7"></a>                              <span class="at">verboseIter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb63-8"><a href="#cb63-8"></a>                              <span class="at">allowParallel =</span> <span class="cn">FALSE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>predictions_b <span class="ot">&lt;-</span> <span class="fu">predict</span>(svm_model_down, <span class="at">newdata =</span> svm_test_data)</span>
<span id="cb64-2"><a href="#cb64-2"></a>conf_matrix_b <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predictions_b, svm_test_data<span class="sc">$</span>DELAYED, <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="fu">print</span>(conf_matrix_b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre style="color: blue"><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0 10177  3729
         1  8275  6639
                                             
               Accuracy : 0.5835             
                 95% CI : (0.5778, 0.5892)   
    No Information Rate : 0.6402             
    P-Value [Acc &gt; NIR] : 1                  
                                             
                  Kappa : 0.1751             
                                             
 Mcnemar's Test P-Value : &lt;0.0000000000000002
                                             
            Sensitivity : 0.6403             
            Specificity : 0.5515             
         Pos Pred Value : 0.4452             
         Neg Pred Value : 0.7318             
             Prevalence : 0.3598             
         Detection Rate : 0.2304             
   Detection Prevalence : 0.5175             
      Balanced Accuracy : 0.5959             
                                             
       'Positive' Class : 1                  
                                             </code></pre>
</div>
</div>
<p>After downsampling, the SVM model achieved an accuracy of 60.1%, below the baseline of 63.05%, but sensitivity improved to 62.82%, indicating better detection of delayed flights—the primary goal. Specificity dropped to 58.51%, reflecting more false positives. Despite lower accuracy, balanced accuracy rose to 60.67% and kappa improved to 0.199, showing a better balance between classes. This trade-off is acceptable given the focus on delays. The next step is to apply recursive feature elimination (RFE) and rerun the model.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb66-2"><a href="#cb66-2"></a></span>
<span id="cb66-3"><a href="#cb66-3"></a>slice30_idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(svm_train_data<span class="sc">$</span>DELAYED, <span class="at">p =</span> <span class="fl">0.3</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-4"><a href="#cb66-4"></a>slice30     <span class="ot">&lt;-</span> svm_train_data[slice30_idx, ]</span>
<span id="cb66-5"><a href="#cb66-5"></a>slice30<span class="sc">$</span>DELAYED <span class="ot">&lt;-</span> <span class="fu">factor</span>(slice30<span class="sc">$</span>DELAYED, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"1"</span>))</span>
<span id="cb66-6"><a href="#cb66-6"></a></span>
<span id="cb66-7"><a href="#cb66-7"></a></span>
<span id="cb66-8"><a href="#cb66-8"></a>slice90_idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(slice30<span class="sc">$</span>DELAYED, <span class="at">p =</span> <span class="fl">0.9</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-9"><a href="#cb66-9"></a>slice90     <span class="ot">&lt;-</span> slice30[slice90_idx, ]</span>
<span id="cb66-10"><a href="#cb66-10"></a></span>
<span id="cb66-11"><a href="#cb66-11"></a>x_rfe   <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(DELAYED <span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> slice90)</span>
<span id="cb66-12"><a href="#cb66-12"></a>y_rfe   <span class="ot">&lt;-</span> slice90<span class="sc">$</span>DELAYED</span>
<span id="cb66-13"><a href="#cb66-13"></a></span>
<span id="cb66-14"><a href="#cb66-14"></a>rfe_ctrl <span class="ot">&lt;-</span> <span class="fu">rfeControl</span>(</span>
<span id="cb66-15"><a href="#cb66-15"></a>  <span class="at">functions     =</span> rfFuncs,</span>
<span id="cb66-16"><a href="#cb66-16"></a>  <span class="at">method        =</span> <span class="st">"cv"</span>,</span>
<span id="cb66-17"><a href="#cb66-17"></a>  <span class="at">number        =</span> <span class="dv">4</span>,</span>
<span id="cb66-18"><a href="#cb66-18"></a>  <span class="at">repeats       =</span> <span class="dv">2</span>,</span>
<span id="cb66-19"><a href="#cb66-19"></a>  <span class="at">verbose       =</span> <span class="cn">TRUE</span>,</span>
<span id="cb66-20"><a href="#cb66-20"></a>  <span class="at">allowParallel =</span> <span class="cn">FALSE</span></span>
<span id="cb66-21"><a href="#cb66-21"></a>)</span>
<span id="cb66-22"><a href="#cb66-22"></a></span>
<span id="cb66-23"><a href="#cb66-23"></a>rfe_results <span class="ot">&lt;-</span> <span class="fu">rfe</span>(</span>
<span id="cb66-24"><a href="#cb66-24"></a>  <span class="at">x          =</span> x_rfe,</span>
<span id="cb66-25"><a href="#cb66-25"></a>  <span class="at">y          =</span> y_rfe,</span>
<span id="cb66-26"><a href="#cb66-26"></a>  <span class="at">sizes      =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>),</span>
<span id="cb66-27"><a href="#cb66-27"></a>  <span class="at">rfeControl =</span> rfe_ctrl</span>
<span id="cb66-28"><a href="#cb66-28"></a>)</span>
<span id="cb66-29"><a href="#cb66-29"></a></span>
<span id="cb66-30"><a href="#cb66-30"></a>selected_features <span class="ot">&lt;-</span> <span class="fu">predictors</span>(rfe_results)</span>
<span id="cb66-31"><a href="#cb66-31"></a><span class="fu">print</span>(selected_features)</span>
<span id="cb66-32"><a href="#cb66-32"></a></span>
<span id="cb66-33"><a href="#cb66-33"></a>train_sel <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-34"><a href="#cb66-34"></a>  svm_train_data[, selected_features, <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb66-35"><a href="#cb66-35"></a>  <span class="at">DELAYED =</span> svm_train_data<span class="sc">$</span>DELAYED</span>
<span id="cb66-36"><a href="#cb66-36"></a>)</span>
<span id="cb66-37"><a href="#cb66-37"></a></span>
<span id="cb66-38"><a href="#cb66-38"></a>test_sel <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-39"><a href="#cb66-39"></a>  svm_test_data[, selected_features, <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb66-40"><a href="#cb66-40"></a>  <span class="at">DELAYED =</span> svm_test_data<span class="sc">$</span>DELAYED</span>
<span id="cb66-41"><a href="#cb66-41"></a>)</span>
<span id="cb66-42"><a href="#cb66-42"></a></span>
<span id="cb66-43"><a href="#cb66-43"></a>train_ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb66-44"><a href="#cb66-44"></a>  <span class="at">method      =</span> <span class="st">"cv"</span>,</span>
<span id="cb66-45"><a href="#cb66-45"></a>  <span class="at">number      =</span> <span class="dv">5</span>,</span>
<span id="cb66-46"><a href="#cb66-46"></a>  <span class="at">sampling    =</span> <span class="st">"down"</span>,</span>
<span id="cb66-47"><a href="#cb66-47"></a>  <span class="at">verboseIter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb66-48"><a href="#cb66-48"></a>  <span class="at">allowParallel =</span> <span class="cn">FALSE</span></span>
<span id="cb66-49"><a href="#cb66-49"></a>)</span>
<span id="cb66-50"><a href="#cb66-50"></a></span>
<span id="cb66-51"><a href="#cb66-51"></a><span class="co">#saveRDS(test_sel, file = "../Models/test_sel.rds")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co">#svm_model_feature &lt;- train(</span></span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="co">#  DELAYED    ~ .,</span></span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="co">#  data       = train_sel,</span></span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="co">#  method     = "svmRadial",</span></span>
<span id="cb67-5"><a href="#cb67-5"></a><span class="co">#  trControl  = train_ctrl,</span></span>
<span id="cb67-6"><a href="#cb67-6"></a><span class="co">#  tuneLength = 3,</span></span>
<span id="cb67-7"><a href="#cb67-7"></a><span class="co">#  preProcess = NULL </span></span>
<span id="cb67-8"><a href="#cb67-8"></a><span class="co">#)</span></span>
<span id="cb67-9"><a href="#cb67-9"></a></span>
<span id="cb67-10"><a href="#cb67-10"></a><span class="co">#saveRDS(svm_model_feature, file = "../Models/svm_model_feature.rds")</span></span>
<span id="cb67-11"><a href="#cb67-11"></a></span>
<span id="cb67-12"><a href="#cb67-12"></a><span class="co"># Load model</span></span>
<span id="cb67-13"><a href="#cb67-13"></a>svm_model_feature <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Models/svm_model_feature.rds"</span>)</span>
<span id="cb67-14"><a href="#cb67-14"></a>test_sel<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../Models/test_sel.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>predicitons_c    <span class="ot">&lt;-</span> <span class="fu">predict</span>(svm_model_feature, <span class="at">newdata =</span> test_sel)</span>
<span id="cb68-2"><a href="#cb68-2"></a>conf_matrix_c <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(predicitons_c, test_sel<span class="sc">$</span>DELAYED, <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="fu">print</span>(conf_matrix_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre style="color: blue"><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0  4824  1572
         1 13628  8796
                                             
               Accuracy : 0.4726             
                 95% CI : (0.4668, 0.4784)   
    No Information Rate : 0.6402             
    P-Value [Acc &gt; NIR] : 1                  
                                             
                  Kappa : 0.0875             
                                             
 Mcnemar's Test P-Value : &lt;0.0000000000000002
                                             
            Sensitivity : 0.8484             
            Specificity : 0.2614             
         Pos Pred Value : 0.3923             
         Neg Pred Value : 0.7542             
             Prevalence : 0.3598             
         Detection Rate : 0.3052             
   Detection Prevalence : 0.7781             
      Balanced Accuracy : 0.5549             
                                             
       'Positive' Class : 1                  
                                             </code></pre>
</div>
</div>
<p>After feature selection, sensitivity is 63.6%, slightly improving the detection of delayed flights, while overall accuracy dropped slightly to 58.0%.</p>
</section>
<section id="interpretation" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="interpretation"><span class="header-section-number">6.3</span> Interpretation</h2>
<p>The initial SVM model struggled to detect delayed flights due to class imbalance, achieving high specificity but very low sensitivity. Downsampling improved sensitivity significantly, aligning better with the goal of identifying delays, though accuracy declined. Feature selection further raised sensitivity to 63.6%, but other performance metrics deteriorated. Overall, all models demonstrate limited predictive power in this context.</p>
<p>After tackling the class imbalance via downsampling, the model was able to predict To improve results, future tests should focus on addressing class imbalance through more advanced resampling strategies, refining the SVM kernel and hyperparameters, or exploring alternative classification approaches such as gradient boosting or ensemble methods that are better suited for imbalanced datasets. A central question in this analysis is identifying which factors—available well before a flight departs—can serve as reliable indicators of arrival delays. Understanding and leveraging such pre-departure features is critical for developing predictive models that can inform operational decision-making in advance.</p>
</section>
</section>
<section id="conclusion" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Conclusion</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="main_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>